<!DOCTYPE html>


<html lang="zh-CN">
  

    <head>
      <meta charset="utf-8" />
        
      <meta
        name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1"
      />
      <title> 风大，进来说</title>
  <meta name="generator" content="hexo-theme-ayer">
      
      <link rel="shortcut icon" href="/favicon.ico" />
       
<link rel="stylesheet" href="/dist/main.css">

      
<link rel="stylesheet" href="/css/fonts/remixicon.css">

      
<link rel="stylesheet" href="/css/custom.css">
 
      <script src="https://cdn.staticfile.org/pace/1.2.4/pace.min.js"></script>
       
 

      <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-bulma@5.0.1/bulma.min.css"
      />
      <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.min.js"></script>

      <!-- mermaid -->
      
      <style>
        .swal2-styled.swal2-confirm {
          font-size: 1.6rem;
        }
      </style>
    <link rel="alternate" href="/atom.xml" title="风大，进来说" type="application/atom+xml">
</head>
  </html>
</html>


<body>
  <div id="app">
    
      
      <canvas width="1777" height="841"
        style="position: fixed; left: 0px; top: 0px; z-index: 99999; pointer-events: none;"></canvas>
      
    <main class="content on">
      
<section class="cover">
    
  <div class="cover-frame">
    <div class="bg-box">
      <img src="/images/cover2.jpg" alt="image frame" />
    </div>
    <div class="cover-inner text-center text-white">
      <h1><a href="/">风大，进来说</a></h1>
      <div id="subtitle-box">
        
        <span id="subtitle"></span>
        
      </div>
      <div>
        
      </div>
    </div>
  </div>
  <div class="cover-learn-more">
    <a href="javascript:void(0)" class="anchor"><i class="ri-arrow-down-line"></i></a>
  </div>
</section>



<script src="https://cdn.staticfile.org/typed.js/2.0.12/typed.min.js"></script>


<!-- Subtitle -->

  <script>
    try {
      var typed = new Typed("#subtitle", {
        strings: ['这世界有太多不如意，但你的生活还是要继续', '太阳每天依旧要升起', '希望永远种在你心里'],
        startDelay: 0,
        typeSpeed: 200,
        loop: true,
        backSpeed: 100,
        showCursor: true
      });
    } catch (err) {
      console.log(err)
    }
  </script>
  
<div id="main">
  <section class="outer">
  
  
  

<div class="notice" style="margin-top:50px">
    <i class="ri-heart-fill"></i>
    <div class="notice-content" id="broad"></div>
</div>
<script type="text/javascript">
    fetch('https://v1.hitokoto.cn')
        .then(response => response.json())
        .then(data => {
            document.getElementById("broad").innerHTML = data.hitokoto;
        })
        .catch(console.error)
</script>

<style>
    .notice {
        padding: 20px;
        border: 1px dashed #e6e6e6;
        color: #969696;
        position: relative;
        display: inline-block;
        width: 100%;
        background: #fbfbfb50;
        border-radius: 10px;
    }

    .notice i {
        float: left;
        color: #999;
        font-size: 16px;
        padding-right: 10px;
        vertical-align: middle;
        margin-top: -2px;
    }

    .notice-content {
        display: initial;
        vertical-align: middle;
    }
</style>
  
  <article class="articles">
    
    
    
    
    <article
  id="post-支付宝扫码支付实现"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2022/01/10/%E6%94%AF%E4%BB%98%E5%AE%9D%E6%89%AB%E7%A0%81%E6%94%AF%E4%BB%98%E5%AE%9E%E7%8E%B0/"
    >支付宝扫码支付实现</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2022/01/10/%E6%94%AF%E4%BB%98%E5%AE%9D%E6%89%AB%E7%A0%81%E6%94%AF%E4%BB%98%E5%AE%9E%E7%8E%B0/" class="article-date">
  <time datetime="2022-01-10T12:48:17.000Z" itemprop="datePublished">2022-01-10</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E4%B8%89%E6%96%B9%E5%AF%B9%E6%8E%A5/">三方对接</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p><code>前言：</code>在一次项目开发中我的业务模块涉及<a target="_blank" rel="noopener" href="https://blog.csdn.net/D_ps19990501/article/details/122856720">微信扫码支付</a>和支付宝扫码支付。在查阅现有技术性文章后发现，许多文章并不能走通，于是我便阅读了官方文档，形成了这篇总结性文章，希望对读者有所帮助。</p>
<p><a target="_blank" rel="noopener" href="https://www.alipay.com/">支付宝平台</a><br><a target="_blank" rel="noopener" href="https://developers.alipay.com/">支付宝开发者中心</a><br><a target="_blank" rel="noopener" href="https://open.alipay.com/">支付宝开放平台</a><br><a target="_blank" rel="noopener" href="https://opendocs.alipay.com/open/194">API开发文档</a><br><a target="_blank" rel="noopener" href="https://github.com/alipay/alipay-easysdk/tree/master/java">官方demo-easySDK</a></p>
<h2 id="支付宝平台信息配置"><a href="#支付宝平台信息配置" class="headerlink" title="支付宝平台信息配置"></a>支付宝平台信息配置</h2><p>相信查询此刻你一定已经注册登陆过<a target="_blank" rel="noopener" href="https://www.alipay.com/">支付宝平台</a>了，在此不多赘述。需在平台中获取的开发所需信息如下：</p>
<p><code>APPID</code>：应用APPID（小程序|小程序插件|小程序模板|网页&amp;移动应用|生活号）</p>
<p><code>ALIPAY_PUBLIC_KEY</code>：支付宝公钥</p>
<p><code>MERCHANT_PRIVATE_KEY</code>：应用私钥</p>
<p><code>SIGN_TYPE</code>：签名类型，Alipay Easy SDK只推荐使用RSA2，估此处固定填写<code>RSA2</code></p>
<p><code>GATEWAYHOST</code>：网关域名，线上为：openapi.alipay.com，沙箱为：openapi.alipaydev.com</p>
<h3 id="关于沙箱环境说明"><a href="#关于沙箱环境说明" class="headerlink" title="关于沙箱环境说明"></a>关于沙箱环境说明</h3><p><code>沙箱环境</code>和<code>线上环境</code>在<strong>代码书写上还好，除了接口请求地址几乎没有差别</strong>，但是在平台配置上差距可是老大了。等于说，沙箱环境不论你是个人账号还是商户账号，只要你申请了沙箱测试环境以上所需的核心参数就直接给你提供了。沙箱工具位置：登录<a target="_blank" rel="noopener" href="https://developers.alipay.com/">支付宝开发者中心</a>，依次点击：<code>控制台</code>→<code>沙箱</code>，就到了沙箱环境的控制台。</p>
<p><img src="http://qn.mfei.fun/img/AK%6058(%60J5%5DLI$N(S)IO%7DTBD.png" alt="img"></p>
<p>进入沙箱环境后，上面列出的商户参数信息一应俱全</p>
<p><img src="http://qn.mfei.fun/img/image-20220920111743828.png" alt="image-20220920111743828"></p>
<p><code>注意：</code></p>
<ol>
<li><code>沙箱应用</code>页面中的<code>沙箱环境</code>→<code>沙箱应用</code>→<code>开发信息</code>中的接口加签方式在此使用推荐的<code>自定义密钥</code>→<code>RSA2密钥</code></li>
<li>需要手动进入<a target="_blank" rel="noopener" href="https://open.alipay.com/svr/ability/get">能力管理</a>页面点击<code>获取更多能力</code>获取所需能力</li>
</ol>
<h3 id="申请支付产品"><a href="#申请支付产品" class="headerlink" title="申请支付产品"></a>申请支付产品</h3><ol>
<li><p>登录<a target="_blank" rel="noopener" href="https://www.alipay.com/">支付宝平台</a>（此时需要商户账号，或者需要管理权限），选择<code>我是商家用户</code>→<code>我是 支付宝/口碑 商家</code>，选择要登录的账号（此时选择商户的账号）</p>
<p><img src="http://qn.mfei.fun/img/image-20220920113327733.png" alt="image-20220920113327733"></p>
</li>
<li><p>找到<code>产品中心</code>，选择<code>当面付</code>，<code>立即开通</code>，此时需要甲方提供：营业执照、网站链接、授权函等信息（缺啥要啥就对了）。</p>
</li>
<li><p>提交后等待审核。</p>
</li>
</ol>
<h3 id="获取应用AppID"><a href="#获取应用AppID" class="headerlink" title="获取应用AppID"></a>获取应用AppID</h3><ol>
<li><p>登录<a target="_blank" rel="noopener" href="https://open.alipay.com/">支付宝开放平台</a>（此时需要商户账号，或者需要管理权限），在控制台页面，查看<code>我的应用</code>，我本次开发甲方提供的是<code>网页&amp;移动应用</code></p>
<p><img src="http://qn.mfei.fun/img/image-20220920113425262.png" alt="image-20220920113425262"></p>
</li>
<li><p>登录<a target="_blank" rel="noopener" href="https://www.alipay.com/">支付宝平台</a></p>
</li>
<li><p>进入后依次点击：<code>账号中心</code>→<code>APPID绑定</code>→<code>添加绑定</code>，输入要绑定的APPID，然后联系商户手机验证码验证即可。</p>
</li>
</ol>
<p><code>补充：</code>以上步骤仅供参考，你的开发过程中可能有各种需要甲方配合的地方，这个要视情况要求甲方配合，比如我在开发过程中甲方信息不完善，甚至连营业执照、公司logo、公司类型等这些基本信息都没上传。</p>
<h3 id="获取支付宝公钥-amp-私钥"><a href="#获取支付宝公钥-amp-私钥" class="headerlink" title="获取支付宝公钥&amp;私钥"></a>获取支付宝公钥&amp;私钥</h3><ol>
<li><p>登录<a target="_blank" rel="noopener" href="https://open.alipay.com/">支付宝开放平台</a>（此时需要商户账号，或者需要管理权限），在控制台页面，查看<code>我的应用</code>，点击进入应用</p>
<p><img src="http://qn.mfei.fun/img/97%5DF6F%5DI%60%7BK$%5D%7BMB%7B3X19CA.png" alt="img"></p>
</li>
<li><p>进入应用信息页找到<code>应用信息</code>，在此页面<code>开发信息</code>中设置密钥，可以选择<a target="_blank" rel="noopener" href="https://miniu.alipay.com/keytool/create">线上生成密钥</a>，也可选择下载支付宝官方平台工具（本人选择的是<a target="_blank" rel="noopener" href="https://gw.alipayobjects.com/os/bmw-prod/0e6297a2-89b9-4cab-972b-f9534ba07082.exe">下载工具</a>）</p>
<p><img src="http://qn.mfei.fun/img/image-20220920113607153.png" alt="image-20220920113607153"></p>
</li>
</ol>
<h2 id="代码中的配置"><a href="#代码中的配置" class="headerlink" title="代码中的配置"></a>代码中的配置</h2><p>主要参考 <a target="_blank" rel="noopener" href="https://opendocs.alipay.com/open/194">API开发文档</a> &amp; <a target="_blank" rel="noopener" href="https://github.com/alipay/alipay-easysdk/tree/master/java">官方demo</a></p>
<h3 id="引入依赖"><a href="#引入依赖" class="headerlink" title="引入依赖"></a>引入依赖</h3><p>此处引入了<code>easysdk</code>工具</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">     &lt;groupId&gt;com.alipay.sdk&lt;/groupId&gt;</span><br><span class="line">     &lt;artifactId&gt;alipay-easysdk&lt;/artifactId&gt;</span><br><span class="line">     &lt;version&gt;<span class="number">2.2</span><span class="number">.1</span>&lt;/version&gt;</span><br><span class="line"> &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line"> &lt;dependency&gt;</span><br><span class="line">     &lt;groupId&gt;com.alipay.sdk&lt;/groupId&gt;</span><br><span class="line">     &lt;artifactId&gt;alipay-sdk-java&lt;/artifactId&gt;</span><br><span class="line">     &lt;version&gt;<span class="number">4.22</span><span class="number">.0</span>.ALL&lt;/version&gt;</span><br><span class="line"> &lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<h3 id="配置请求参数实体类"><a href="#配置请求参数实体类" class="headerlink" title="配置请求参数实体类"></a>配置请求参数实体类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AlipayNotifyParam</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String appId;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 支付宝交易凭证号</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">private</span> String tradeNo;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 原支付请求的商户订单号</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String outTradeNo;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 商户业务ID，主要是退款通知中返回退款申请的流水号</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String outBizNo;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 买家支付宝账号对应的支付宝唯一用户号。以2088开头的纯16位数字</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String buyerId;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 买家支付宝账号</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String buyerLogonId;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 卖家支付宝用户号</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String sellerId;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 卖家支付宝账号</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String sellerEmail;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 交易目前所处的状态，见交易状态说明</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String tradeStatus;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 本次交易支付的订单金额</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> BigDecimal totalAmount;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 商家在交易中实际收到的款项</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> BigDecimal receiptAmount;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户在交易中支付的金额</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> BigDecimal buyerPayAmount;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 退款通知中，返回总退款金额，单位为元，支持两位小数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> BigDecimal refundFee;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 商品的标题/交易标题/订单标题/订单关键字等</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String subject;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 该订单的备注、描述、明细等。对应请求时的body参数，原样通知回来</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String body;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 该笔交易创建的时间。格式为yyyy-MM-dd HH:mm:ss</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Date gmtCreate;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 该笔交易的买家付款时间。格式为yyyy-MM-dd HH:mm:ss</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Date gmtPayment;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 该笔交易的退款时间。格式为yyyy-MM-dd HH:mm:ss.S</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Date gmtRefund;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 该笔交易结束时间。格式为yyyy-MM-dd HH:mm:ss</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Date gmtClose;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 支付成功的各个渠道金额信息,array</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String fundBillList;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 公共回传参数，如果请求时传递了该参数，则返回给商户时会在异步通知时将该参数原样返回。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String passbackParams;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="配置支付工具类"><a href="#配置支付工具类" class="headerlink" title="配置支付工具类"></a>配置支付工具类</h3><p>此工具类仅供参考，配置信息也可根据个人喜好放在yml文件中（为方便阅读此处放在类中作为常量）。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AlipayUtil</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">APPID</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">MERCHANT_PRIVATE_KEY</span> <span class="operator">=</span> <span class="string">&quot;私钥内容&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">ALIPAY_PUBLIC_KEY</span> <span class="operator">=</span> <span class="string">&quot;公钥内容&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">NOTIFY_URL</span> <span class="operator">=</span> <span class="string">&quot;回调地址&quot;</span>;</span><br><span class="line">    <span class="comment">// 签名类型，Alipay Easy SDK只推荐使用RSA2，估此处固定填写RSA2</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">SIGN_TYPE</span> <span class="operator">=</span> <span class="string">&quot;RSA2&quot;</span>;</span><br><span class="line">    <span class="comment">// 请求使用的编码格式，如utf-8,gbk,gb2312等</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">CHARSET</span> <span class="operator">=</span> <span class="string">&quot;utf-8&quot;</span>;</span><br><span class="line">    <span class="comment">// 主机域名</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">GATEWAYHOST</span> <span class="operator">=</span> <span class="string">&quot;openapi.alipay.com&quot;</span>;</span><br><span class="line">    <span class="comment">// 请求协议</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">PROTOCOL</span> <span class="operator">=</span> <span class="string">&quot;https&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Author</span> Spence_Dou</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Description</span> 配置请求配置</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Date</span> 16:49 2021/12/29</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> com.alipay.8.kernel.Config</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Config <span class="title function_">getOptions</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Config</span> <span class="variable">config</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Config</span>();</span><br><span class="line">        config.protocol = PROTOCOL;</span><br><span class="line">        config.gatewayHost = GATEWAYHOST;</span><br><span class="line">        config.signType = SIGN_TYPE;</span><br><span class="line">        config.appId = APPID;</span><br><span class="line">        config.merchantPrivateKey = AlipayUtil.MERCHANT_PRIVATE_KEY;</span><br><span class="line">        <span class="comment">// 如果采用非证书模式，则无需赋值三个证书路径，改为赋值如下的支付宝公钥字符串即可</span></span><br><span class="line">        config.alipayPublicKey = AlipayUtil.ALIPAY_PUBLIC_KEY;</span><br><span class="line">        <span class="comment">//可设置异步通知接收服务地址（可选）</span></span><br><span class="line">         config.notifyUrl = NOTIFY_URL;</span><br><span class="line">        <span class="comment">//可设置AES密钥，调用AES加解密相关接口时需要（可选）</span></span><br><span class="line">        <span class="comment">// 32位，需要的话直接生成随机字符串，需要在商户平台配置，位置在证书那一块</span></span><br><span class="line">        config.encryptKey = <span class="string">&quot;*********&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> config;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Author</span> Spence_Dou</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Description</span> 生成订单号</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Date</span> 22:05 2021/12/28</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Param</span> []</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> java.lang.String</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">orderNo</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> UUID.randomUUID().toString()</span><br><span class="line">                .replaceAll(<span class="string">&quot;-&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">                .substring(<span class="number">0</span>, <span class="number">32</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Author</span> Spence_Dou</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Description</span> 将request中的参数转为Map</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Date</span> 18:01 2021/12/29</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Param</span> request 回调请求</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> java.util.Map&lt;java.lang.String,java.lang.String&gt;</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Map&lt;String, String&gt; <span class="title function_">convertRequestParamsToMap</span><span class="params">(HttpServletRequest request)</span>&#123;</span><br><span class="line">        HashMap&lt;String, String&gt; retMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        Set&lt;Map.Entry&lt;String, String[]&gt;&gt; entrySet = request.getParameterMap().entrySet();</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, String[]&gt; entry : entrySet)&#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> entry.getKey();</span><br><span class="line">            String[] values = entry.getValue();</span><br><span class="line">            <span class="type">int</span> <span class="variable">valLen</span> <span class="operator">=</span> values.length;</span><br><span class="line">            <span class="keyword">if</span> (valLen == <span class="number">1</span>)&#123;</span><br><span class="line">                retMap.put(name, values[<span class="number">0</span>]);</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span> (valLen &gt; <span class="number">1</span>)&#123;</span><br><span class="line">                <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">                <span class="keyword">for</span> (String val : values)&#123;</span><br><span class="line">                    sb.append(<span class="string">&quot;,&quot;</span>).append(val);</span><br><span class="line">                &#125;</span><br><span class="line">                retMap.put(name, sb.toString().substring(<span class="number">1</span>));</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                retMap.put(name, <span class="string">&quot;&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> retMap;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Author</span> Spence_Dou</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Description</span> 校验AppID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Date</span> 20:32 2021/12/29</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Param</span> params 回调信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">check</span><span class="params">(Map&lt;String, String&gt; params)</span> <span class="keyword">throws</span> AlipayApiException &#123;</span><br><span class="line">        <span class="keyword">if</span> (!params.get(<span class="string">&quot;app_id&quot;</span>).equals(APPID)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AlipayApiException</span>(<span class="string">&quot;app_id不一致&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Author</span> Spence_Dou</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Description</span> 生成请求实体类</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Date</span> 17:51 2022/2/12</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Param</span> params 响应体参数转map</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> marchsoft.modules.spiritdeerpush.common.utils.pay.alipay.AlipayNotifyParam</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> AlipayNotifyParam <span class="title function_">buildAlipayNotifyParam</span><span class="params">(Map&lt;String, String&gt; params)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> JSON.toJSONString(params);</span><br><span class="line">        <span class="keyword">return</span> JSON.parseObject(json, AlipayNotifyParam.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="支付请求"><a href="#支付请求" class="headerlink" title="支付请求"></a>支付请求</h3><p>不同的产品功能应参考<a target="_blank" rel="noopener" href="https://github.com/alipay/alipay-easysdk/tree/master/java">官方demo-easySDK</a>，此处以面对面支付为例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 生成系统订单号</span></span><br><span class="line"><span class="type">String</span> <span class="variable">outTradeNo</span> <span class="operator">=</span> AlipayUtil.orderNo();</span><br><span class="line"><span class="comment">// 1. 设置参数（全局只需设置一次）</span></span><br><span class="line">Factory.setOptions(AlipayUtil.getOptions());</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">	<span class="comment">// 2. 发起API调用，description: 商品描述; total: 金额（元）</span></span><br><span class="line">	<span class="comment">// 响应的 response 都有哪些参数，自己去看文档，太多了不一一描述</span></span><br><span class="line">	<span class="type">AlipayTradePrecreateResponse</span> <span class="variable">response</span> <span class="operator">=</span> Factory.Payment.FaceToFace()</span><br><span class="line">			.preCreate(description, outTradeNo, total.toString());</span><br><span class="line">	<span class="comment">// 3. 处理响应或异常</span></span><br><span class="line">	<span class="keyword">if</span> (ResponseChecker.success(response)) &#123;</span><br><span class="line">		<span class="comment">// 付款二维码</span></span><br><span class="line">		<span class="type">String</span> <span class="variable">qrCode</span> <span class="operator">=</span> response.getQrCode();</span><br><span class="line">		<span class="comment">/**</span></span><br><span class="line"><span class="comment">		 * 在此可进行订单信息入库等业务逻辑操作</span></span><br><span class="line"><span class="comment">		*/</span></span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		System.err.println(<span class="string">&quot;调用失败，原因：&quot;</span> + response.msg + <span class="string">&quot;，&quot;</span> + response.subMsg);</span><br><span class="line">		<span class="comment">// 此处自定义抛出异常为公司框架所封装</span></span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BadRequestException</span>(response.msg);</span><br><span class="line">	&#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">	System.err.println(<span class="string">&quot;调用遭遇异常，原因：&quot;</span> + e.getMessage());</span><br><span class="line">	<span class="comment">// 手动关闭事务</span></span><br><span class="line">	<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e.getMessage(), e);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="回调接口"><a href="#回调接口" class="headerlink" title="回调接口"></a>回调接口</h3><p>此接口地址对应支付请求时的请求参数notify_url，具体功能介绍在此不做阐述</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 将request中的参数转为Map</span></span><br><span class="line">Map&lt;String, String&gt; stringStringMap = AlipayUtil.convertRequestParamsToMap(request);</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">	<span class="comment">// 调用SDK验证签名</span></span><br><span class="line">	<span class="type">boolean</span> <span class="variable">signVerified</span> <span class="operator">=</span> AlipaySignature.rsaCheckV1(stringStringMap, AlipayUtil.ALIPAY_PUBLIC_KEY, AlipayUtil.CHARSET, AlipayUtil.SIGN_TYPE);</span><br><span class="line">	<span class="keyword">if</span> (signVerified)&#123;</span><br><span class="line">		AlipayUtil.check(stringStringMap);</span><br><span class="line">		<span class="type">AlipayNotifyParam</span> <span class="variable">param</span> <span class="operator">=</span> AlipayUtil.buildAlipayNotifyParam(stringStringMap);</span><br><span class="line">		<span class="comment">// 订单状态</span></span><br><span class="line">		<span class="type">String</span> <span class="variable">trade_status</span> <span class="operator">=</span> param.getTradeStatus();</span><br><span class="line">		<span class="comment">// 支付成功</span></span><br><span class="line">		<span class="keyword">if</span> (trade_status.equals(<span class="string">&quot;TRADE_SUCCESS&quot;</span>)</span><br><span class="line">				|| trade_status.equals(<span class="string">&quot;TRADE_FINISHED&quot;</span>))&#123;</span><br><span class="line">			<span class="comment">/**</span></span><br><span class="line"><span class="comment">		 	* 在此可进行订单信息维护等业务逻辑操作</span></span><br><span class="line"><span class="comment">			*/</span></span><br><span class="line">		&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="comment">// 此处自定义抛出异常为公司框架所封装</span></span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BadRequestException</span>(<span class="string">&quot;支付失败！&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">	&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="comment">// 不明白 failure 啥意思的话去看文档</span></span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;failure&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (AlipayApiException e) &#123;</span><br><span class="line">	e.printStackTrace();</span><br><span class="line">	<span class="comment">//强制手动事务回滚</span></span><br><span class="line">	TransactionAspectSupport.currentTransactionStatus().setRollbackOnly();</span><br><span class="line">	<span class="keyword">return</span> <span class="string">&quot;failure&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%94%AF%E4%BB%98/" rel="tag">支付</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%94%AF%E4%BB%98%E5%AE%9D/" rel="tag">支付宝</a></li></ul>

    </footer>
  </div>

    
 
   
  
</article>

    
    <article
  id="post-微信扫码支付实现"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2022/01/06/%E5%BE%AE%E4%BF%A1%E6%89%AB%E7%A0%81%E6%94%AF%E4%BB%98%E5%AE%9E%E7%8E%B0/"
    >微信扫码支付实现</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2022/01/06/%E5%BE%AE%E4%BF%A1%E6%89%AB%E7%A0%81%E6%94%AF%E4%BB%98%E5%AE%9E%E7%8E%B0/" class="article-date">
  <time datetime="2022-01-06T07:42:33.000Z" itemprop="datePublished">2022-01-06</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E4%B8%89%E6%96%B9%E5%AF%B9%E6%8E%A5/">三方对接</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p><code>前言：</code>在一次项目开发中我的业务模块涉及微信扫码支付和<a target="_blank" rel="noopener" href="https://blog.csdn.net/D_ps19990501/article/details/122870559">支付宝扫码支付</a>。在查阅现有文档后发现，大部分文章还停留在V2支付，部分文章介绍了V3支付但是并不能走通，于是我便阅读了官方文档，形成了这篇总结性文章，希望对读者有所帮助。</p>
<p><a target="_blank" rel="noopener" href="https://pay.weixin.qq.com/wiki/doc/apiv3/open/pay/chapter2_7_2.shtml">官方开发文档</a><br><a target="_blank" rel="noopener" href="https://github.com/wechatpay-apiv3/wechatpay-apache-httpclient">官方SDK开发工具包</a><br><a target="_blank" rel="noopener" href="https://pay.weixin.qq.com/wiki/doc/apiv3/apis/chapter3_4_1.shtml">API字典</a></p>
<h2 id="微信平台信息配置"><a href="#微信平台信息配置" class="headerlink" title="微信平台信息配置"></a>微信平台信息配置</h2><p>相信此刻你一定已经注册并登陆过 <a target="_blank" rel="noopener" href="https://pay.weixin.qq.com/index.php/core/home/login">微信开放平台</a> 了，在此不多赘述。需在平台中获取的开发所需信息如下：</p>
<p><code>MERCHANT_ID</code>：商户号<br><code>MERCHANT_SERIAL_NUMBER</code>：商户<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=API&spm=1001.2101.3001.7020">API</a>证书的证书序列号<br><code>MERCHANT_PRIVATEKEY</code>：商户API<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E7%A7%81%E9%92%A5&spm=1001.2101.3001.7020">私钥</a><br><code>AIV3KEY</code>：API v3密钥<br><code>APP_ID</code>：小程序的APPID</p>
<p><strong>注意</strong>：想要获取以上信息，必须是商户主账号才可以（即便是管理员，部分操作也无法完成）。<br><code>下面我们来逐个获取以上参数</code></p>
<h3 id="获取商户号"><a href="#获取商户号" class="headerlink" title="获取商户号"></a>获取商户号</h3><ol>
<li><p>登录微信开放平台</p>
</li>
<li><p>如果是主账号，如图红框位置即为商户号。如果不是商户主帐号，显示的则为个人帐号（如图为子管理员账号）<img src="http://qn.mfei.fun/img/image-20220920105144822.png" alt="image-20220920105144822"></p>
</li>
<li><p>如果登陆账号不是主账号，则需要依次点击<code>产品中心</code>→<code>AppID账号管理</code>→<code>+关联AppID</code>，此时即可看到商户号<img src="http://qn.mfei.fun/img/image-20220920105304787.png" alt="image-20220920105304787"></p>
</li>
</ol>
<h3 id="获取证书序列号"><a href="#获取证书序列号" class="headerlink" title="获取证书序列号"></a>获取证书序列号</h3><p><code>该步骤操作需要商户主账号才可完成。</code></p>
<ol>
<li>依次点击<code>账户中心</code>→<code>API安全</code>，此时就进入了API安全页，此页面可设置一个证书两个密钥，API证书是根据网站提供的工具生成的（具体下载操作可参考网站中给出的指引）</li>
</ol>
<p><img src="http://qn.mfei.fun/img/image-20220920105436865.png" alt="image-20220920105436865"></p>
<ol start="2">
<li><p>对微信工具生成的文件进行解压缩得到如下信息，后续操作可根据’<code>证书使用说明.txt</code>进行（提示一下：Windows用户直接双击<code>apiclient_cert.p12</code>文件即可上传证书）。</p>
<p><img src="http://qn.mfei.fun/img/image-20220920105620364.png" alt="image-20220920105620364"></p>
</li>
<li><p>在根据网站指引完成了API证书上传后，商户主账号就可直接点击<code>管理证书</code>查看证书序列号。</p>
<p><img src="http://qn.mfei.fun/img/image-20220920105701828.png" alt="image-20220920105701828"></p>
</li>
</ol>
<h3 id="获取API私钥"><a href="#获取API私钥" class="headerlink" title="获取API私钥"></a>获取API私钥</h3><p>在获取证书序列号的第二步操作中的<code>apiclient_key.pem</code>文件即为所需的商户API私钥。</p>
<p><img src="http://qn.mfei.fun/img/image-20220920105751973.png" alt="image-20220920105751973"></p>
<p><strong>注意</strong>：此处有一个小坑，在粘贴复制密钥时，除了保留<code>-----BEGIN PRIVATE KEY-----</code>和<code>-----END PRIVATE KEY-----</code>的换行外，中间内容在粘贴时一定要去除复制时产生的换行符（推荐复制内容后去网上的<code>去换行工具</code>中去除下换行符）</p>
<p><img src="http://qn.mfei.fun/img/image-20220920105839862.png" alt="image-20220920105839862"></p>
<h3 id="获取APIv3密钥"><a href="#获取APIv3密钥" class="headerlink" title="获取APIv3密钥"></a>获取APIv3密钥</h3><ol>
<li><p>依旧是在API安全页，直接点击<code>设置</code>来设置APIv3密钥即可。</p>
<p><img src="http://qn.mfei.fun/img/image-20220920105919903.png" alt="image-20220920105919903"></p>
<p><img src="http://qn.mfei.fun/img/image-20220920110022358.png" alt="image-20220920110022358"></p>
</li>
<li><p>APIv3密钥要求是<code>32个字符，支持数字/大小写字母</code>，可以在随机生成字符串的线上工具中进行生成</p>
<p><img src="http://qn.mfei.fun/img/image-20220920110118699.png" alt="image-20220920110118699"></p>
</li>
<li><p>将上一步生成的密钥复制粘贴，完成手机号验证码安全认证即可完成APIv3密钥的设置</p>
<p><img src="http://qn.mfei.fun/img/image-20220920110208295.png" alt="image-20220920110208295"></p>
</li>
</ol>
<h3 id="获取并绑定APPID"><a href="#获取并绑定APPID" class="headerlink" title="获取并绑定APPID"></a>获取并绑定APPID</h3><p><code>公众号和小程序的AppID获取方式雷同，具体参考如图所示指引</code></p>
<p><img src="http://qn.mfei.fun/img/image-20220920110308848.png" alt="image-20220920110308848"></p>
<ol>
<li><p>登录<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/">微信公众平台</a>，依次点击<code>设置</code>→<code>基本设置</code>，页面最下方账号信息处即可看到<code>AppID（小程序ID）</code></p>
<p><img src="http://qn.mfei.fun/img/image-20220920110345880.png" alt="image-20220920110345880"></p>
</li>
<li><p>在微信公众平台，依次点击<code>设置</code>→<code>基本设置</code>，找到<code>主体信息</code></p>
<p><img src="http://qn.mfei.fun/img/image-20220920110414964.png" alt="image-20220920110414964"></p>
</li>
<li><p>回到<a target="_blank" rel="noopener" href="https://pay.weixin.qq.com/index.php/core/home/login">微信开放平台</a>，依次点击<code>产品中心</code>→<code>AppID账号管理</code>→<code>+关联AppID</code>，将上一步获取到的<code>AppID</code>和<code>主体信息</code>粘贴在此并提交</p>
<p><img src="http://qn.mfei.fun/img/63%7DY%5DE4%7B%60~BJ%5DA_0SQXM5WO.png" alt="img"></p>
</li>
<li><p>回到微信公众平台授权即可</p>
<p><img src="http://qn.mfei.fun/img/6R8XM6VGU1VD0D%4HIP%7D8$V.png" alt="img"></p>
</li>
</ol>
<h3 id="开通支付产品"><a href="#开通支付产品" class="headerlink" title="开通支付产品"></a>开通支付产品</h3><ol>
<li><p>登录微信开放平台，来到<code>产品中心</code>页面。</p>
</li>
<li><p>开启支付产品中的<code>Native支付</code>(扫码支付)功能。</p>
</li>
<li><p>开启运营工具中的<code>企业付款到零钱</code>(付款资金直接进入微信零钱，提现方式根据用户需求来开通不同产品即可)。</p>
<p><img src="http://qn.mfei.fun/img/image-20220920110605286.png" alt="image-20220920110605286"></p>
</li>
</ol>
<h2 id="代码中的配置"><a href="#代码中的配置" class="headerlink" title="代码中的配置"></a>代码中的配置</h2><p>对于v3支付来说，此时可谓万事俱备只欠东风，下面来配置代码中的工具类和第三方请求。</p>
<h3 id="引入依赖"><a href="#引入依赖" class="headerlink" title="引入依赖"></a>引入依赖</h3><p>此处引入的是<code>v3支付</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.github.wechatpay-apiv3&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;wechatpay-apache-httpclient&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">0.3</span><span class="number">.0</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<h3 id="配置微信工具类"><a href="#配置微信工具类" class="headerlink" title="配置微信工具类"></a>配置微信工具类</h3><p>此工具类仅供参考，配置信息也可根据个人喜好放在yml文件中（为方便阅读此处放在类中作为常量）。<br><code>此处的工具类有以下作用：</code></p>
<ol>
<li>配置商户信息</li>
<li>微信接口请求所需工具方法</li>
<li>微信验签</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WeChartUtil</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">MERCHANT_ID</span> <span class="operator">=</span> <span class="string">&quot;商户id&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">MERCHANT_SERIAL_NUMBER</span> <span class="operator">=</span> <span class="string">&quot;证书序列号&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">MERCHANT_PRIVATEKEY</span> <span class="operator">=</span> <span class="string">&quot;-----BEGIN PRIVATE KEY-----\n&quot;</span> +</span><br><span class="line"><span class="string">&quot;你的密钥内容（记得去换行）&quot;</span> +</span><br><span class="line">  <span class="string">&quot;\n&quot;</span> + <span class="string">&quot;-----END PRIVATE KEY-----&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">AIV3KEY</span> <span class="operator">=</span> <span class="string">&quot;APIv3密钥&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">NOTIFY_URL</span> <span class="operator">=</span> <span class="string">&quot;回调地址&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">APP_ID</span> <span class="operator">=</span> <span class="string">&quot;小程序的AppID&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Author</span> Spence_Dou</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Description</span> 生成订单号</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Date</span> 11:35 2021/12/23</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">orderNo</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> UUID.randomUUID().toString()</span><br><span class="line">                .replaceAll(<span class="string">&quot;-&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">                .substring(<span class="number">0</span>, <span class="number">32</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Author</span> Spence_Dou</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Description</span> 生成订单过期时间</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Date</span> 11:41 2021/12/23</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> java.time.LocalDateTime</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">timeExpire</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//过期时间：5分钟后</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">time</span> <span class="operator">=</span> <span class="number">5</span>*<span class="number">60</span>*<span class="number">1000</span>;</span><br><span class="line">        <span class="type">SimpleDateFormat</span> <span class="variable">simpleDateFormat</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd&#x27;T&#x27;HH:mm:ssXXX&quot;</span>);</span><br><span class="line">        <span class="type">Date</span> <span class="variable">now</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">        <span class="comment">//30分钟后的时间</span></span><br><span class="line">        <span class="type">Date</span> <span class="variable">afterDate</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>(now.getTime() + time);</span><br><span class="line">        <span class="keyword">return</span> simpleDateFormat.format(afterDate);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Author</span> Spence_Dou</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Description</span> 分转元 保留小数点后两位</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Date</span> 11:38 2021/12/23</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Param</span> num 转换金额</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> java.lang.String</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> BigDecimal <span class="title function_">transition</span><span class="params">(Integer num)</span> &#123;</span><br><span class="line">        <span class="type">BigDecimal</span> <span class="variable">bigDecimal1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BigDecimal</span>(num + <span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="type">BigDecimal</span> <span class="variable">bigDecimal2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BigDecimal</span>(<span class="string">&quot;100.00&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> bigDecimal1.divide(bigDecimal2).setScale(<span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Author</span> Spence_Dou</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Description</span> 微信支付回调签名验证</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Date</span> 16:30 2021/12/23</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Param</span> serial 请求头序列号</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Param</span> message 请求报文</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Param</span> signature 签名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> boolean</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">signVerify</span><span class="params">(String serial, String message, String signature)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">PrivateKey</span> <span class="variable">key</span> <span class="operator">=</span> PemUtil.loadPrivateKey(<span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(MERCHANT_PRIVATEKEY.getBytes(StandardCharsets.UTF_8)));</span><br><span class="line">            <span class="type">ScheduledUpdateCertificatesVerifier</span> <span class="variable">verifier</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ScheduledUpdateCertificatesVerifier</span>(</span><br><span class="line">                    <span class="keyword">new</span> <span class="title class_">WechatPay2Credentials</span>(MERCHANT_ID, <span class="keyword">new</span> <span class="title class_">PrivateKeySigner</span>(MERCHANT_SERIAL_NUMBER, key)),</span><br><span class="line">                    AIV3KEY.getBytes(StandardCharsets.UTF_8));</span><br><span class="line">            <span class="keyword">return</span> verifier.verify(serial, message.getBytes(StandardCharsets.UTF_8), signature);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Author</span> Spence_Dou</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Description</span> 解密密文</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Date</span> 17:04 2021/12/23</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Param</span> body 请求数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> java.lang.String</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">decryptOrder</span><span class="params">(String body)</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">AesUtil</span> <span class="variable">util</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AesUtil</span>(AIV3KEY.getBytes(StandardCharsets.UTF_8));</span><br><span class="line">            <span class="type">ObjectMapper</span> <span class="variable">objectMapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">            <span class="type">JsonNode</span> <span class="variable">node</span> <span class="operator">=</span> objectMapper.readTree(body);</span><br><span class="line">            <span class="type">JsonNode</span> <span class="variable">resource</span> <span class="operator">=</span> node.get(<span class="string">&quot;resource&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">ciphertext</span> <span class="operator">=</span> resource.get(<span class="string">&quot;ciphertext&quot;</span>).textValue();</span><br><span class="line">            <span class="type">String</span> <span class="variable">associatedData</span> <span class="operator">=</span> resource.get(<span class="string">&quot;associated_data&quot;</span>).textValue();</span><br><span class="line">            <span class="type">String</span> <span class="variable">nonce</span> <span class="operator">=</span> resource.get(<span class="string">&quot;nonce&quot;</span>).textValue();</span><br><span class="line">            <span class="keyword">return</span> util.decryptToString(associatedData.getBytes(StandardCharsets.UTF_8), nonce.getBytes(StandardCharsets.UTF_8), ciphertext);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException | GeneralSecurityException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Author</span> Spence_Dou</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Description</span> 关闭订单</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Date</span> 17:34 2021/12/23</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Param</span> outTradeNo 订单号</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">closeOrder</span><span class="params">(String outTradeNo)</span> &#123;</span><br><span class="line">        <span class="type">PrivateKey</span> <span class="variable">key</span> <span class="operator">=</span> PemUtil.loadPrivateKey(<span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(MERCHANT_PRIVATEKEY.getBytes(StandardCharsets.UTF_8)));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 使用定时更新的签名验证器，不需要传入证书</span></span><br><span class="line">        <span class="type">ScheduledUpdateCertificatesVerifier</span> <span class="variable">verifier</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ScheduledUpdateCertificatesVerifier</span>(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">WechatPay2Credentials</span>(MERCHANT_ID, <span class="keyword">new</span> <span class="title class_">PrivateKeySigner</span>(MERCHANT_SERIAL_NUMBER, key)),</span><br><span class="line">                AIV3KEY.getBytes(StandardCharsets.UTF_8));</span><br><span class="line"></span><br><span class="line">        <span class="type">WechatPayHttpClientBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> WechatPayHttpClientBuilder.create()</span><br><span class="line">                .withMerchant(MERCHANT_ID, MERCHANT_SERIAL_NUMBER, key)</span><br><span class="line">                .withValidator(<span class="keyword">new</span> <span class="title class_">WechatPay2Validator</span>(verifier));</span><br><span class="line">        <span class="type">CloseableHttpClient</span> <span class="variable">httpClient</span> <span class="operator">=</span> builder.build();</span><br><span class="line"></span><br><span class="line">        <span class="type">HttpPost</span> <span class="variable">httpPost</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpPost</span>(<span class="string">&quot;https://api.mch.weixin.qq.com/v3/pay/transactions/out-trade-no/&quot;</span>+outTradeNo+<span class="string">&quot;/close&quot;</span>);</span><br><span class="line">        httpPost.addHeader(<span class="string">&quot;Accept&quot;</span>, <span class="string">&quot;application/json&quot;</span>);</span><br><span class="line">        httpPost.addHeader(<span class="string">&quot;Content-type&quot;</span>,<span class="string">&quot;application/json; charset=utf-8&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">ByteArrayOutputStream</span> <span class="variable">bos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">            <span class="type">ObjectMapper</span> <span class="variable">objectMapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line"></span><br><span class="line">            <span class="type">ObjectNode</span> <span class="variable">rootNode</span> <span class="operator">=</span> objectMapper.createObjectNode();</span><br><span class="line">            rootNode.put(<span class="string">&quot;mchid&quot;</span>,MERCHANT_ID);</span><br><span class="line">            objectMapper.writeValue(bos, rootNode);</span><br><span class="line"></span><br><span class="line">            httpPost.setEntity(<span class="keyword">new</span> <span class="title class_">StringEntity</span>(bos.toString(<span class="string">&quot;UTF-8&quot;</span>), <span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">            <span class="type">CloseableHttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> httpClient.execute(httpPost);</span><br><span class="line"></span><br><span class="line">            <span class="type">String</span> <span class="variable">bodyAsString</span> <span class="operator">=</span> EntityUtils.toString(response.getEntity());</span><br><span class="line">            System.out.println(bodyAsString);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="支付请求"><a href="#支付请求" class="headerlink" title="支付请求"></a>支付请求</h3><ul>
<li>该请求方式参照文章开头提供的SDK开发工具包中的请求方式</li>
<li>不同的产品应参考 <a target="_blank" rel="noopener" href="https://pay.weixin.qq.com/wiki/doc/apiv3/apis/chapter3_4_1.shtml">API字典</a> 请求不同的地址，此处以<code>Native支付</code>为例</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">PrivateKey</span> <span class="variable">key</span> <span class="operator">=</span> PemUtil.loadPrivateKey(<span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(WeChartUtil.MERCHANT_PRIVATEKEY.getBytes(StandardCharsets.UTF_8)));</span><br><span class="line"><span class="comment">// 使用定时更新的签名验证器，不需要传入证书</span></span><br><span class="line"><span class="type">ScheduledUpdateCertificatesVerifier</span> <span class="variable">verifier</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ScheduledUpdateCertificatesVerifier</span>(</span><br><span class="line">		<span class="keyword">new</span> <span class="title class_">WechatPay2Credentials</span>(WeChartUtil.MERCHANT_ID, <span class="keyword">new</span> <span class="title class_">PrivateKeySigner</span>(WeChartUtil.MERCHANT_SERIAL_NUMBER, key)),</span><br><span class="line">		WeChartUtil.AIV3KEY.getBytes(StandardCharsets.UTF_8));</span><br><span class="line"></span><br><span class="line"><span class="type">WechatPayHttpClientBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> WechatPayHttpClientBuilder.create()</span><br><span class="line">		.withMerchant(WeChartUtil.MERCHANT_ID, WeChartUtil.MERCHANT_SERIAL_NUMBER, key)</span><br><span class="line">		.withValidator(<span class="keyword">new</span> <span class="title class_">WechatPay2Validator</span>(verifier));</span><br><span class="line"><span class="comment">// 通过WechatPayHttpClientBuilder构造的HttpClient，会自动的处理签名和验签，并进行证书自动更新</span></span><br><span class="line"><span class="type">CloseableHttpClient</span> <span class="variable">httpClient</span> <span class="operator">=</span> builder.build();</span><br><span class="line"></span><br><span class="line"><span class="type">HttpPost</span> <span class="variable">httpPost</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpPost</span>(<span class="string">&quot;https://api.mch.weixin.qq.com/v3/pay/transactions/native&quot;</span>);</span><br><span class="line">httpPost.addHeader(<span class="string">&quot;Accept&quot;</span>, <span class="string">&quot;application/json&quot;</span>);</span><br><span class="line">httpPost.addHeader(<span class="string">&quot;Content-type&quot;</span>,<span class="string">&quot;application/json; charset=utf-8&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">ByteArrayOutputStream</span> <span class="variable">bos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line"><span class="type">ObjectMapper</span> <span class="variable">objectMapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line"><span class="comment">// 生成订单号</span></span><br><span class="line"><span class="type">String</span> <span class="variable">outTradeNo</span> <span class="operator">=</span> WeChartUtil.orderNo();</span><br><span class="line"><span class="comment">// 请求参数</span></span><br><span class="line"><span class="type">ObjectNode</span> <span class="variable">rootNode</span> <span class="operator">=</span> objectMapper.createObjectNode();</span><br><span class="line">rootNode.put(<span class="string">&quot;mchid&quot;</span>,WeChartUtil.MERCHANT_ID)</span><br><span class="line">		.put(<span class="string">&quot;appid&quot;</span>, WeChartUtil.APP_ID)</span><br><span class="line">		.put(<span class="string">&quot;notify_url&quot;</span>, WeChartUtil.NOTIFY_URL)</span><br><span class="line">		.put(<span class="string">&quot;out_trade_no&quot;</span>, outTradeNo)</span><br><span class="line">		.put(<span class="string">&quot;time_expire&quot;</span>, WeChartUtil.timeExpire())</span><br><span class="line">		.put(<span class="string">&quot;description&quot;</span>, description); <span class="comment">// 订单描述（前端获取）</span></span><br><span class="line">rootNode.putObject(<span class="string">&quot;amount&quot;</span>)</span><br><span class="line">		.put(<span class="string">&quot;total&quot;</span>, <span class="number">1</span>); <span class="comment">// 此处支付金额单位为分</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">	objectMapper.writeValue(bos, rootNode);</span><br><span class="line">	httpPost.setEntity(<span class="keyword">new</span> <span class="title class_">StringEntity</span>(bos.toString(<span class="string">&quot;UTF-8&quot;</span>), <span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">	<span class="type">CloseableHttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> httpClient.execute(httpPost);</span><br><span class="line">	<span class="type">String</span> <span class="variable">bodyAsString</span> <span class="operator">=</span> EntityUtils.toString(response.getEntity());</span><br><span class="line">	<span class="comment">// 这里就是请求支付后返回的数据了</span></span><br><span class="line">	<span class="type">JSONObject</span> <span class="variable">details</span> <span class="operator">=</span> JSONObject.parseObject(bodyAsString);</span><br><span class="line">	<span class="comment">// 支付二维码</span></span><br><span class="line">	String qrCode= details.getString(<span class="string">&quot;code_url&quot;</span>);</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment"> 	* 此处可进行订单数据持久化等业务操作</span></span><br><span class="line"><span class="comment"> 	* ...</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">	e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="回调接口"><a href="#回调接口" class="headerlink" title="回调接口"></a><a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E5%9B%9E%E8%B0%83&spm=1001.2101.3001.7020">回调</a>接口</h3><ul>
<li><p>这里就是v3支付和v2支付一个比较明显的区别点，<strong>v2支付的回调地址是在官方网站中配置的，而v3支付中，回调地址是作为请求参数传递到微信的</strong>。</p>
</li>
<li><p>此接口地址对应支付请求时的请求参数<code>notify_url</code>，具体功能介绍在此不做阐述</p>
<p><img src="http://qn.mfei.fun/img/%60N%60T~F0RUGXLA[VRCG[72%Y.png" alt="img"></p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Map <span class="title function_">wxCallback</span><span class="params">(HttpServletRequest request)</span> &#123;</span><br><span class="line">		<span class="type">Map</span> <span class="variable">result</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">		result.put(<span class="string">&quot;code&quot;</span>, <span class="string">&quot;FAIL&quot;</span>);</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="type">StringBuilder</span> <span class="variable">signStr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">			signStr.append(request.getHeader(<span class="string">&quot;Wechatpay-Timestamp&quot;</span>)).append(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">			signStr.append(request.getHeader(<span class="string">&quot;Wechatpay-Nonce&quot;</span>)).append(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">			<span class="type">BufferedReader</span> <span class="variable">br</span> <span class="operator">=</span> request.getReader();</span><br><span class="line">			<span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">			<span class="type">StringBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">			<span class="keyword">while</span> ((str = br.readLine()) != <span class="literal">null</span>)&#123;</span><br><span class="line">				builder.append(str);</span><br><span class="line">			&#125;</span><br><span class="line">			signStr.append(builder.toString()).append(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">			<span class="comment">// 验证签名</span></span><br><span class="line">			<span class="keyword">if</span> (!WeChartUtil.signVerify(request.getHeader(<span class="string">&quot;Wechatpay-Serial&quot;</span>), signStr.toString(), request.getHeader(<span class="string">&quot;Wechatpay-Signature&quot;</span>)))&#123;</span><br><span class="line">				result.put(<span class="string">&quot;message&quot;</span>, <span class="string">&quot;sign error&quot;</span>);</span><br><span class="line">				<span class="keyword">return</span> result;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">// 解密密文</span></span><br><span class="line">			<span class="type">String</span> <span class="variable">decryptOrder</span> <span class="operator">=</span> WeChartUtil.decryptOrder(builder.toString());</span><br><span class="line">			<span class="comment">// 验证订单</span></span><br><span class="line">			<span class="type">JSONObject</span> <span class="variable">details</span> <span class="operator">=</span> JSONObject.parseObject(decryptOrder);</span><br><span class="line">			<span class="comment">// 获取订单状态</span></span><br><span class="line">			<span class="type">String</span> <span class="variable">ciphertext</span> <span class="operator">=</span> details.getString(<span class="string">&quot;trade_state&quot;</span>);</span><br><span class="line">			<span class="keyword">if</span> (<span class="string">&quot;SUCCESS&quot;</span>.equals(ciphertext))&#123;</span><br><span class="line">				<span class="comment">/**</span></span><br><span class="line"><span class="comment">		 		* 此处可进行订单状态数据持久化等业务操作</span></span><br><span class="line"><span class="comment">		 		* ...</span></span><br><span class="line"><span class="comment">				*/</span></span><br><span class="line">				result.put(<span class="string">&quot;code&quot;</span>, <span class="string">&quot;SUCCESS&quot;</span>);</span><br><span class="line">				result.put(<span class="string">&quot;message&quot;</span>, <span class="string">&quot;成功&quot;</span>);</span><br><span class="line">				<span class="comment">// 关闭订单</span></span><br><span class="line">				WeChartUtil.closeOrder(details.getString(<span class="string">&quot;out_trade_no&quot;</span>));</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">			<span class="comment">//强制手动事务回滚</span></span><br><span class="line">			TransactionAspectSupport.currentTransactionStatus().setRollbackOnly();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%BE%AE%E4%BF%A1/" rel="tag">微信</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%94%AF%E4%BB%98/" rel="tag">支付</a></li></ul>

    </footer>
  </div>

    
 
   
  
</article>

    
    <article
  id="post-状态模式"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/04/01/%E7%8A%B6%E6%80%81%E6%A8%A1%E5%BC%8F/"
    >状态模式</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/04/01/%E7%8A%B6%E6%80%81%E6%A8%A1%E5%BC%8F/" class="article-date">
  <time datetime="2021-04-01T02:28:54.000Z" itemprop="datePublished">2021-04-01</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">设计模式</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><p>状态模式（State Pattern）：允许一个对象在其内部状态改变时改变它的行为，对象看起来似乎修改了它的类。其别名为状态对象（Objects for Status）。简而言之——<code>对象可根据不同情况作出不同行为</code>。</p>
<p><code>阿里规范手册有言：</code>超过三层的if-else的逻辑判断代码可以使用卫语句（指在分支判断中提前返回）、策略模式、状态模式来实现，其中卫语句示例如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">today</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (isBusy()) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;change time.&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (isFree()) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;go to travel.&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="代码对比演示"><a href="#代码对比演示" class="headerlink" title="代码对比演示"></a>代码对比演示</h3><p><strong>条件判断对象属性</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="string">&quot;Happy&quot;</span>.equals(zhangSan.getState()))&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;跑着去学校&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="string">&quot;Sad&quot;</span>.equals(zhangSan.getState()))&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;走着去学校&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="string">&quot;Sick&quot;</span>.equals(zhangSan.getState()))&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;病了不去学校&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>状态模式改造</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StatePattern</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Student</span> <span class="variable">zhangSan</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>();</span><br><span class="line">        zhangSan.changeState(<span class="keyword">new</span> <span class="title class_">Happy</span>());</span><br><span class="line">        zhangSan.howToGo(); <span class="comment">// 跑着去学校</span></span><br><span class="line">        zhangSan.changeState(<span class="keyword">new</span> <span class="title class_">Sad</span>());</span><br><span class="line">        zhangSan.howToGo(); <span class="comment">// 走着去学校</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 状态接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">State</span>&#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">goSchool</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Happy</span> <span class="keyword">implements</span> <span class="title class_">State</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">goSchool</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;跑着去学校&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Sad</span> <span class="keyword">implements</span> <span class="title class_">State</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">goSchool</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;走着去学校&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Sick</span> <span class="keyword">implements</span> <span class="title class_">State</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">goSchool</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;病了不去学校&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> State state;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">changeState</span><span class="params">(State state)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.state = state;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">howToGo</span><span class="params">()</span>&#123;</span><br><span class="line">        state.goSchool();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>改用枚举</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StatePattern</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        Student.Happy.howToGo();</span><br><span class="line">        Student.Sad.howToGo();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">State</span>&#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">goSchool</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Happy</span> <span class="keyword">implements</span> <span class="title class_">State</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">goSchool</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;跑着去学校&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Sad</span> <span class="keyword">implements</span> <span class="title class_">State</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">goSchool</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;走着去学校&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Sick</span> <span class="keyword">implements</span> <span class="title class_">State</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">goSchool</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;病了不去学校&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Student</span>&#123;</span><br><span class="line">    Happy(<span class="keyword">new</span> <span class="title class_">Happy</span>()),</span><br><span class="line"></span><br><span class="line">    Sad(<span class="keyword">new</span> <span class="title class_">Sad</span>()),</span><br><span class="line"></span><br><span class="line">    Sick(<span class="keyword">new</span> <span class="title class_">Sick</span>());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> State state;</span><br><span class="line"></span><br><span class="line">    Student(State state) &#123;</span><br><span class="line">        <span class="built_in">this</span>.state = state;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">howToGo</span><span class="params">()</span>&#123;</span><br><span class="line">        state.goSchool();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="类图"><a href="#类图" class="headerlink" title="类图"></a>类图</h3><p><img src="http://qn.mfei.fun/img/~%60MMWQC6YI5N$N_RZM$9R%60S.png" alt="img"></p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%8A%B6%E6%80%81%E6%A8%A1%E5%BC%8F/" rel="tag">状态模式</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="tag">设计模式</a></li></ul>

    </footer>
  </div>

    
 
   
  
</article>

    
    <article
  id="post-观察者模式"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/03/22/%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F/"
    >观察者模式</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/03/22/%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F/" class="article-date">
  <time datetime="2021-03-22T08:40:25.000Z" itemprop="datePublished">2021-03-22</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">设计模式</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h2 id="了解观察者模式"><a href="#了解观察者模式" class="headerlink" title="了解观察者模式"></a>了解观察者模式</h2><h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><p>观察者模式（Observer Pattern）。定义对象间的一种<code>一对多的依赖关系</code>，使得每当一个对象状态发生改变时，其相关依赖对象皆得到通知并被自动更新。</p>
<h3 id="举例"><a href="#举例" class="headerlink" title="举例"></a>举例</h3><p>张三欠了很多人钱，债主每天来要钱对谁都不好。于是就可以让张三有钱时主动通知债主，没钱时就让债主等着（债主就是观察者，观察张三有没有钱）。于是观察者模式又叫<code>发布者模式</code>。</p>
<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 观察者模式</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ObserverPattern</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 张三为借钱者</span></span><br><span class="line">        <span class="type">Debit</span> <span class="variable">zhangSan</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DebitImpl</span>();</span><br><span class="line">        <span class="comment">// 向老板借钱</span></span><br><span class="line">        zhangSan.borrow(<span class="keyword">new</span> <span class="title class_">Boss</span>());</span><br><span class="line">        <span class="comment">// 向朋友借钱</span></span><br><span class="line">        zhangSan.borrow(<span class="keyword">new</span> <span class="title class_">Friend</span>());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 自行改变判断state为true时（有钱后）通知还钱</span></span><br><span class="line">        zhangSan.notifyCreadits();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 借贷者接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Debit</span>&#123;</span><br><span class="line">    <span class="comment">// 向贷款方借钱</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">borrow</span><span class="params">(Credit credit)</span>;</span><br><span class="line">    <span class="comment">// 通知债主自己要还钱</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">notifyCreadits</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 贷款者</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DebitImpl</span> <span class="keyword">implements</span> <span class="title class_">Debit</span>&#123;</span><br><span class="line">    <span class="comment">// 创建一个数据结构存放这些债主</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Credit&gt; allCredits = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">// 当为true时表示有钱，可以通知还钱</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">state</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">borrow</span><span class="params">(Credit credit)</span> &#123;</span><br><span class="line">        <span class="comment">// 每借一个人的钱就把这个人存到集合中去</span></span><br><span class="line">        allCredits.add(credit);</span><br><span class="line">        System.out.println(<span class="string">&quot;张三借钱！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">notifyCreadits</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 还钱时直接遍历集合通知还钱</span></span><br><span class="line">        allCredits.forEach(credit -&gt; credit.takeMoney());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 贷款方（债主）接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Credit</span>&#123;</span><br><span class="line">    <span class="comment">// 债主要钱</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">takeMoney</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Boss</span> <span class="keyword">implements</span> <span class="title class_">Credit</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">takeMoney</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Boss得到偿还&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Friend</span> <span class="keyword">implements</span> <span class="title class_">Credit</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">takeMoney</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Friend得到偿还&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="类图"><a href="#类图" class="headerlink" title="类图"></a>类图</h3><p><img src="http://qn.mfei.fun/img/%7DBZ6CUEI4CJWAZASBC54W1K.png" alt="img"></p>
<h2 id="观察者模式应用"><a href="#观察者模式应用" class="headerlink" title="观察者模式应用"></a>观察者模式应用</h2><h3 id="情景使用——天气预报"><a href="#情景使用——天气预报" class="headerlink" title="情景使用——天气预报"></a>情景使用——天气预报</h3><p>描述：气象站想要把自己测量的温度、湿度、天气等信息以公告形式发布出去（如：自己的官网或QQ、微信等第三方），那么他就需要设计开放型的的API（提供温度、湿度、气压等接口），便于其他第三方也能接入气象站获取数据。测量数据更新时要能实时的通知给第三方。</p>
<p><img src="http://qn.mfei.fun/img/image-20220919152121253.png" alt="image-20220919152121253"></p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F/" rel="tag">观察者模式</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="tag">设计模式</a></li></ul>

    </footer>
  </div>

    
 
   
  
</article>

    
    <article
  id="post-Lambda四大函数"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/11/08/Lambda%E5%9B%9B%E5%A4%A7%E5%87%BD%E6%95%B0/"
    >Lambda四大函数</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2020/11/08/Lambda%E5%9B%9B%E5%A4%A7%E5%87%BD%E6%95%B0/" class="article-date">
  <time datetime="2020-11-08T11:52:27.000Z" itemprop="datePublished">2020-11-08</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/java/">java</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p>Lambda是一个<strong>匿名函数</strong>，可以把它理解为是一段可以传递的代码（将代码像数据一样进行传递）。</p>
<h2 id="对比Lambda与传统开发方式："><a href="#对比Lambda与传统开发方式：" class="headerlink" title="对比Lambda与传统开发方式："></a>对比Lambda与传统开发方式：</h2><h3 id="1-开发方式一："><a href="#1-开发方式一：" class="headerlink" title="1. 开发方式一："></a>1. 开发方式一：</h3><p><strong>提供一个员工类</strong>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Employee</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> salary;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Employee</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Employee</span><span class="params">(String name, <span class="type">int</span> age, <span class="type">double</span> salary)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">        <span class="built_in">this</span>.salary = salary;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getAge</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(<span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getSalary</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> salary;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSalary</span><span class="params">(<span class="type">double</span> salary)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.salary = salary;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Employee&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, age=&quot;</span> + age +</span><br><span class="line">                <span class="string">&quot;, salary=&quot;</span> + salary +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>在另一个类中new几个员工：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test_01</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> List&lt;Employee&gt; employees = Arrays.asList(</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="string">&quot;张三&quot;</span>,<span class="number">18</span>,<span class="number">9999.99</span>),</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="string">&quot;李四&quot;</span>,<span class="number">38</span>,<span class="number">5555.55</span>),</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="string">&quot;王五&quot;</span>,<span class="number">50</span>,<span class="number">6666.66</span>),</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="string">&quot;赵六&quot;</span>,<span class="number">16</span>,<span class="number">3333.33</span>),</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="string">&quot;陈七&quot;</span>,<span class="number">8</span>,<span class="number">7777.77</span>)</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>获取年龄大于35的员工信息：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;Employee&gt; <span class="title function_">filterEmployees1</span><span class="params">(List&lt;Employee&gt; list)</span>&#123;</span><br><span class="line">    List&lt;Employee&gt; emps = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (Employee emp : list) &#123;</span><br><span class="line">        <span class="keyword">if</span> (emp.getAge() &gt;= <span class="number">35</span>)&#123;</span><br><span class="line">            emps.add(emp);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> emps;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>获取工资大于5000的员工信息：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;Employee&gt; <span class="title function_">filterEmployees2</span><span class="params">(List&lt;Employee&gt; list)</span>&#123;</span><br><span class="line">    List&lt;Employee&gt; emps = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (Employee emp : list) &#123;</span><br><span class="line">        <span class="keyword">if</span> (emp.getSalary() &gt;= <span class="number">5000</span>)&#123;</span><br><span class="line">            emps.add(emp);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> emps;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-优化开发（优化年龄筛选和薪资筛选）："><a href="#2-优化开发（优化年龄筛选和薪资筛选）：" class="headerlink" title="2. 优化开发（优化年龄筛选和薪资筛选）："></a>2. 优化开发（优化年龄筛选和薪资筛选）：</h3><h4 id="2-1-优化方案一：策略设计模式"><a href="#2-1-优化方案一：策略设计模式" class="headerlink" title="2.1 优化方案一：策略设计模式"></a>2.1 优化方案一：策略设计模式</h4><p>优化后筛选方法只需要一个，只是多了几个过滤接口的实体类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//写一个加泛型的接口。传入一个泛型对象，返回一个布尔值</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">MyPredicate</span>&lt;T&gt;&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">test</span><span class="params">(T t)</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//实现类——年龄过滤</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FilterEmployeeByAge</span> <span class="keyword">implements</span> <span class="title class_">MyPredicate</span>&lt;Employee&gt;&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">test</span><span class="params">(Employee t)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> t.getAge() &gt;= <span class="number">35</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//实现类——工资过滤</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FilterEmployeeBySalary</span> <span class="keyword">implements</span> <span class="title class_">MyPredicate</span>&lt;Employee&gt;&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">test</span><span class="params">(Employee t)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> t.getSalary() &gt;= <span class="number">5000</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>写一个加过滤的筛选方法：</strong></p>
<p>此时调用此方法时只需要传入不同的实现类即可实现不同条件的筛选。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;Employee&gt; <span class="title function_">filterEmployees</span><span class="params">(List&lt;Employee&gt; list,MyPredicate&lt;Employee&gt; mp)</span>&#123;</span><br><span class="line">    List&lt;Employee&gt; emps = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (Employee emp : list) &#123;</span><br><span class="line">        <span class="keyword">if</span> (mp.test(emp))&#123;</span><br><span class="line">            emps.add(emp);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> emps;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//此时调用此方法时只需要传入不同的实现类即可实现不同条件的筛选</span></span><br><span class="line"><span class="comment">//如：获取年龄大于35的员工信息：</span></span><br><span class="line">List&lt;Employee&gt; list = filterEmployees(employees,<span class="keyword">new</span> <span class="title class_">FilterEmployeeByAge</span>());</span><br></pre></td></tr></table></figure>

<h4 id="2-2-优化方案二：匿名内部类"><a href="#2-2-优化方案二：匿名内部类" class="headerlink" title="2.2 优化方案二：匿名内部类"></a>2.2 优化方案二：匿名内部类</h4><p>优化后不在上次优化基础上不再需要创建多个类（通过直接new接口来取代接口的实现类）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method3</span><span class="params">()</span>&#123;</span><br><span class="line">    List&lt;Employee&gt; list = filterEmployees(employees, <span class="keyword">new</span> <span class="title class_">MyPredicate</span>&lt;Employee&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">test</span><span class="params">(Employee employee)</span> &#123;</span><br><span class="line">            <span class="comment">//返回工资大于五千的员工</span></span><br><span class="line">            <span class="keyword">return</span> employee.getSalary() &gt;= <span class="number">5000</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-3-优化方式三：lambda表达式"><a href="#2-3-优化方式三：lambda表达式" class="headerlink" title="2.3 优化方式三：lambda表达式"></a>2.3 优化方式三：lambda表达式</h4><p>直接实现函数式接口，无需匿名内部类去实现。减少代码量</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method4</span><span class="params">()</span>&#123;</span><br><span class="line">    	<span class="comment">//此处Test_01.employees中的Test_01为包名</span></span><br><span class="line">        List&lt;Employee&gt; list = (Test_01.employees, (e) -&gt; e.getSalary() &lt;= <span class="number">5000</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-4-优化方式四：Stream-API"><a href="#2-4-优化方式四：Stream-API" class="headerlink" title="2.4 优化方式四：Stream API"></a>2.4 优化方式四：Stream API</h4><p>无需接口、无需接口实现类，<strong>只需要最原始的那个list集合</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method5</span><span class="params">()</span>&#123;</span><br><span class="line">    employees.stream()</span><br><span class="line">        .filter((e) -&gt; e.getSalary() &gt;= <span class="number">5000</span>)</span><br><span class="line">        .forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Lambda表达式语法"><a href="#Lambda表达式语法" class="headerlink" title="Lambda表达式语法"></a>Lambda表达式语法</h2><h3 id="箭头符"><a href="#箭头符" class="headerlink" title="箭头符"></a>箭头符</h3><p>Java8引入一个新的操作符”-&gt;”该操作符称为<strong>箭头操作符</strong>或<strong>lambda操作符</strong></p>
<p>该操作符将lambda表达式拆分成了两部分：</p>
<p>左侧为lambda表达式的<strong>参数列表</strong></p>
<p>右侧为lambda表达式所需要的功能，即 <strong>lambda体</strong></p>
<h3 id="语法格式"><a href="#语法格式" class="headerlink" title="语法格式"></a>语法格式</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//语法格式一：无参数无返回值</span></span><br><span class="line"><span class="comment">//() -&gt; System.out.println(&quot;Hello Word!&quot;);</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method1</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">Runnable</span> <span class="variable">r1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">        <span class="comment">//匿名内部类写法</span></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Hello Word!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    r1.run();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//lambda写法</span></span><br><span class="line">    <span class="type">Runnable</span> <span class="variable">r2</span> <span class="operator">=</span> () -&gt; System.out.println(<span class="string">&quot;Hello Word!&quot;</span>);</span><br><span class="line">    r2.run();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//语法格式二：有一个参数，无返回值</span></span><br><span class="line"><span class="comment">//(x) -&gt; System.out.println(x);</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method2</span><span class="params">()</span>&#123;</span><br><span class="line">    Consumer&lt;String&gt; con = (x) -&gt; System.out.println(x);</span><br><span class="line">    con.accept(<span class="string">&quot;窦鹏森牛逼&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//语法格式三：若只有一个参数，小括号可以省略不写（习惯上是不省略的）</span></span><br><span class="line"><span class="comment">//x -&gt; System.out.println(x);</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method3</span><span class="params">()</span>&#123;</span><br><span class="line">    Consumer&lt;String&gt; con = x -&gt; System.out.println(x);</span><br><span class="line">    con.accept(<span class="string">&quot;窦鹏森牛逼&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//语法格式四：有两个以上参数，并且 lambda 体中有多条语句，并且有返回值</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method4</span><span class="params">()</span>&#123;</span><br><span class="line">    Comparator&lt;Integer&gt; con = (x,y) -&gt; &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;函数式接口&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> Integer.compare(x,y);</span><br><span class="line">    &#125;;</span><br><span class="line">    con.compare(<span class="number">5</span>,<span class="number">6</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//语法格式五：若 lambda 体中只有一条语句，return 和 大括号 都可以省略不写</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method5</span><span class="params">()</span>&#123;</span><br><span class="line">    Comparator&lt;Integer&gt; con = (x,y) -&gt; Integer.compare(x,y);</span><br><span class="line">    con.compare(<span class="number">5</span>,<span class="number">6</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//语法格式六：lambda 表达式的参数列表的数据类型可以省略不写（要么全省略，要么全不省略）。</span></span><br><span class="line"><span class="comment">//因为JVM编译器可通过上下文推断出数据类型，即“类型推断”</span></span><br></pre></td></tr></table></figure>

<h3 id="函数式接口"><a href="#函数式接口" class="headerlink" title="函数式接口"></a>函数式接口</h3><p>lambda表达式需要<strong>函数式接口</strong>的支持</p>
<p><strong>函数式接口</strong>：接口中只有一个抽象方法的接口，称为函数式接口。可以使用**@FunctionalInterface**修饰</p>
<p><strong>@FunctionalInterface</strong>：可以检查接口是否为函数式接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//一个方法接口</span></span><br><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Myfun</span>&#123;</span><br><span class="line">    Integer <span class="title function_">getValue</span><span class="params">(Integer num)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//测试类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Test</span>&#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method6</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//调用运算方法，传入运算值，设置运算方法</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">integer</span> <span class="operator">=</span> method7(<span class="number">100</span>, (x) -&gt; x + x);</span><br><span class="line">        System.out.println(integer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//运算方法</span></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">method7</span><span class="params">(Integer num,Myfun mu)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mu.getValue(num);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="实际应用"><a href="#实际应用" class="headerlink" title="实际应用"></a>实际应用</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//字符串处理练习</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">A</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getValue</span><span class="params">(String str)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Test</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">method2</span><span class="params">(String str,A a)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a.getValue(str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method3</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//去除首尾空格</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> method2(<span class="string">&quot;\t\t\t 窦鹏森牛逼&quot;</span>, (str) -&gt; str.trim());</span><br><span class="line">        <span class="comment">//字符串转大写</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">s2</span> <span class="operator">=</span> method2(<span class="string">&quot;abcdefg&quot;</span>, (str) -&gt; str.toUpperCase());</span><br><span class="line">        <span class="comment">//截取字符串中的指定一段</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">s3</span> <span class="operator">=</span> method2(<span class="string">&quot;窦鹏森牛逼&quot;</span>, (str) -&gt; str.substring(<span class="number">0</span>, <span class="number">3</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Long类型运算</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">B</span>&lt;T,R&gt;&#123;</span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">add</span><span class="params">(T t1,T t2)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Test</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method4</span><span class="params">(Long l1,Long l2,B&lt;Long,Long&gt; b)</span>&#123;</span><br><span class="line">        System.out.println(b.add(l1, l2));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method5</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//加法运算</span></span><br><span class="line">        method4(<span class="number">4500l</span>,<span class="number">56800l</span>,(x,y) -&gt; x + y);</span><br><span class="line">        <span class="comment">//乘法运算</span></span><br><span class="line">        method4(<span class="number">4500l</span>,<span class="number">56800l</span>,(x,y) -&gt; x * y);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="四大内置核心函数式接口"><a href="#四大内置核心函数式接口" class="headerlink" title="四大内置核心函数式接口"></a>四大内置核心函数式接口</h2><h3 id="Consumer-lt-T-gt-：消费型接口"><a href="#Consumer-lt-T-gt-：消费型接口" class="headerlink" title="Consumer&lt; T &gt;：消费型接口"></a>Consumer&lt; T &gt;：消费型接口</h3><p>所谓“<strong>消费</strong>”，即“<strong>有去无回</strong>”，<strong>传入参数，无返回值</strong></p>
<p>参数类型：T</p>
<p>返回类型：void</p>
<p>用途：对类型为T的对象应用操作</p>
<p>包含方法：void accept(T t);</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Consumer&lt;T&gt; 消费型接口：</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method1</span><span class="params">()</span>&#123;</span><br><span class="line">    happy(<span class="number">1000</span>,(x) -&gt; System.out.println(<span class="string">&quot;今晚大保健，消费&quot;</span> + x + <span class="string">&quot;元&quot;</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">happy</span><span class="params">(<span class="type">double</span> money, Consumer&lt;Double&gt; con)</span>&#123;</span><br><span class="line">    con.accept(money);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Supplier-lt-T-gt-：供给型接口"><a href="#Supplier-lt-T-gt-：供给型接口" class="headerlink" title="Supplier&lt; T &gt;：供给型接口"></a>Supplier&lt; T &gt;：供给型接口</h3><p>所谓“<strong>供给</strong>”，即“<strong>无需传参</strong>，<strong>有返回值</strong>”</p>
<p>参数类型：无</p>
<p>返回类型：T</p>
<p>用途：返回类型为T的对象</p>
<p>包含方法：T get();</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Supplier&lt;T&gt; 供给型接口：</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method2</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(getNumList(<span class="number">10</span>, () -&gt; (<span class="type">int</span>) (Math.random() * <span class="number">100</span>)));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//产生指定个数的整数，并放入集合中去</span></span><br><span class="line"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">getNumList</span><span class="params">(<span class="type">int</span> num, Supplier&lt;Integer&gt; sup)</span>&#123;</span><br><span class="line">    List&lt;Integer&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;i&lt;num;i++)&#123;</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">n</span> <span class="operator">=</span> sup.get();</span><br><span class="line">        list.add(n);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> list;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Function-lt-T-R-gt-：函数型接口"><a href="#Function-lt-T-R-gt-：函数型接口" class="headerlink" title="Function&lt; T,R &gt;：函数型接口"></a>Function&lt; T,R &gt;：函数型接口</h3><p>所谓“函数型，即”<strong>函数处理</strong>“，<strong>传入一值，返回一值</strong></p>
<p>参数类型：T</p>
<p>返回类型：R</p>
<p>用途：对类型为T的对象应用操作，并返回结果。结果是R类型的对象</p>
<p>包含方法：R apply(T t);</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Function&lt;T,R&gt; 函数型接口：</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method3</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//去除首尾空格</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> strHandler(<span class="string">&quot;\t\t\t  卢本伟牛逼，卢本伟牛逼&quot;</span>, (s) -&gt; s.trim());</span><br><span class="line">    <span class="comment">//截取字符串</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">s2</span> <span class="operator">=</span> strHandler(<span class="string">&quot;卢本伟牛逼，卢本伟牛逼&quot;</span>, (s) -&gt; s.substring(<span class="number">0</span>,<span class="number">3</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//处理字符串</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">strHandler</span><span class="params">(String str, Function&lt;String,String&gt; fun)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> fun.apply(str);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Predicate-lt-T-gt-：断定型接口"><a href="#Predicate-lt-T-gt-：断定型接口" class="headerlink" title="Predicate&lt; T &gt;：断定型接口"></a>Predicate&lt; T &gt;：断定型接口</h3><p>所谓“断定”，即“<strong>对…作出判断</strong>”，故需<strong>传入参数，返回正误</strong></p>
<p>参数类型：T</p>
<p>返回类型：boolean</p>
<p>用途：确定类型为T的对象是否满足某约束，并返回boolean值</p>
<p>包含方法：boolean test(T t);</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Predicate&lt;T&gt; 断言型接口</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method4</span><span class="params">()</span>&#123;</span><br><span class="line">    List&lt;String&gt; list = Arrays.asList(<span class="string">&quot;马云&quot;</span>,<span class="string">&quot;马化腾&quot;</span>,<span class="string">&quot;雷军&quot;</span>,<span class="string">&quot;乔布斯&quot;</span>,<span class="string">&quot;王健林&quot;</span>,<span class="string">&quot;李纲&quot;</span>,<span class="string">&quot;窦鹏森&quot;</span>);</span><br><span class="line">    <span class="comment">//筛选出长度大于二的字符串</span></span><br><span class="line">    List&lt;String&gt; strings = filterStr(list, (s) -&gt; s.length() &gt; <span class="number">2</span>);</span><br><span class="line">    <span class="keyword">for</span> (String string : strings) &#123;</span><br><span class="line">        System.out.println(string);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//将满足条件的字符串，放入集合中</span></span><br><span class="line"><span class="keyword">public</span> List&lt;String&gt; <span class="title function_">filterStr</span><span class="params">(List&lt;String&gt; list, Predicate&lt;String&gt; pre)</span>&#123;</span><br><span class="line">    ArrayList&lt;String&gt; strList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (String s : list) &#123;</span><br><span class="line">        <span class="keyword">if</span> (pre.test(s))&#123;</span><br><span class="line">            strList.add(s);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> strList;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="方法引用-与-构造器引用"><a href="#方法引用-与-构造器引用" class="headerlink" title="方法引用 与 构造器引用"></a>方法引用 与 构造器引用</h2><h3 id="方法引用"><a href="#方法引用" class="headerlink" title="方法引用"></a>方法引用</h3><p><strong>若lambda体中的内容有方法已经实现了，可以使用“方法引用”。可以理解为方法引用是lambda表达式的另一种表现形式。</strong></p>
<p><strong>注意：</strong></p>
<ul>
<li>lambda体中调用方法的参数列表与返回值类型，要与函数式接口中抽象方法的函数列表和返回值类型保持一致！</li>
<li>若lambda的参数列表，<strong>参数一是实例方法的调用者</strong>，<strong>参数二是实例方法的参数时</strong>，可以用 <strong>类::实例方法名</strong> 调用</li>
</ul>
<h4 id="语法格式一："><a href="#语法格式一：" class="headerlink" title="语法格式一："></a>语法格式一：</h4><p><strong>对象::实例方法（非静态方法）名</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//对象::实例方法</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method1</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">Employee</span> <span class="variable">emp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Employee</span>();</span><br><span class="line">    <span class="comment">//对Supplier类的get方法进行实现，返回emp.getName()</span></span><br><span class="line">    Supplier&lt;String&gt; sup1 = () -&gt; emp.getName();</span><br><span class="line">    <span class="comment">//通过Supplier类的对象sup1执行get方法，获取emp.getName()的值</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> sup1.get();</span><br><span class="line">    System.out.println(str);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//因为getAge()方法已经被实现，直接通过对象引用该实例方法即可</span></span><br><span class="line">    Supplier&lt;Integer&gt; sup2 = emp::getAge;</span><br><span class="line">    <span class="type">Integer</span> <span class="variable">num</span> <span class="operator">=</span> sup2.get();</span><br><span class="line">    System.out.println(num);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="语法格式二："><a href="#语法格式二：" class="headerlink" title="语法格式二："></a>语法格式二：</h4><p><strong>类::静态方法名</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//类::静态方法名</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method2</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//比较两数大小，Integer类中有静态方法已经实现比较的功能，故 类.方法名</span></span><br><span class="line">    Comparator&lt;Integer&gt; com1 = (x,y) -&gt; Integer.compare(x,y);</span><br><span class="line">    com1.compare(<span class="number">30</span>,<span class="number">40</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//因为类中已有静态方法实现lambda方法体中欲实现的功能，故可用方法引用</span></span><br><span class="line">    Comparator&lt;Integer&gt; com2 = Integer::compare;</span><br><span class="line">    <span class="type">int</span> <span class="variable">compare</span> <span class="operator">=</span> com2.compare(<span class="number">80</span>, <span class="number">70</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="语法格式三："><a href="#语法格式三：" class="headerlink" title="语法格式三："></a>语法格式三：</h4><p><strong>类::实例方法名</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//类::实例方法名</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method3</span><span class="params">()</span>&#123;</span><br><span class="line">    BiPredicate&lt;String,String&gt; b1 = (x,y) -&gt; x.equals(y);</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">t1</span> <span class="operator">=</span> b1.test(<span class="string">&quot;窦哥&quot;</span>, <span class="string">&quot;窦鹏森&quot;</span>);</span><br><span class="line">    System.out.println(t1);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//当lambda中的两个参数，参数一是实例方法的调用者，参数二是实例方法的参数时，可以用 类::实例方法名 调用</span></span><br><span class="line">    BiPredicate&lt;String,String&gt; b2 = String::equals;</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">t2</span> <span class="operator">=</span> b1.test(<span class="string">&quot;窦哥&quot;</span>, <span class="string">&quot;窦哥哥&quot;</span>);</span><br><span class="line">    System.out.println(t2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="构造器引用"><a href="#构造器引用" class="headerlink" title="构造器引用"></a>构造器引用</h3><p><strong>格式</strong>：<strong>ClassName::new</strong></p>
<p><strong>注意：</strong></p>
<ul>
<li>需要<strong>调用的构造器的参数列表</strong>要与<strong>函数式接口中抽象方法的参数列表</strong>保持一致</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//构造器引用</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method4</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//无参构造</span></span><br><span class="line">    Supplier&lt;Employee&gt; sup1 = () -&gt; <span class="keyword">new</span> <span class="title class_">Employee</span>();</span><br><span class="line">    <span class="type">Employee</span> <span class="variable">emp1</span> <span class="operator">=</span> sup1.get();</span><br><span class="line"></span><br><span class="line">    Supplier&lt;Employee&gt; sup2 = Employee::<span class="keyword">new</span>;</span><br><span class="line">    <span class="type">Employee</span> <span class="variable">emp2</span> <span class="operator">=</span> sup2.get();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//一个参数的构造器（Employee类中要有对应构造器）</span></span><br><span class="line">    <span class="comment">//此时要用Function&lt;T,R&gt;</span></span><br><span class="line">    <span class="comment">//两个参数时用BiFunction&lt;T, U, R&gt;</span></span><br><span class="line">    <span class="comment">//调用有参构造时，如果new Employee();中不写参数，则默认引用无参构造。接下来通过Function对象调用applay()方法时就不能传参了。</span></span><br><span class="line">    Function&lt;String,Employee&gt; fun1 = (str) -&gt; <span class="keyword">new</span> <span class="title class_">Employee</span>(str);</span><br><span class="line">    <span class="type">Employee</span> <span class="variable">emp3</span> <span class="operator">=</span> fun1.apply(<span class="string">&quot;窦鹏森&quot;</span>);</span><br><span class="line"></span><br><span class="line">    Function&lt;String,Employee&gt; fun2 = Employee::<span class="keyword">new</span>;</span><br><span class="line">    <span class="comment">//调用apply()方法时直接传入对应参数即可</span></span><br><span class="line">    <span class="type">Employee</span> <span class="variable">emp4</span> <span class="operator">=</span> fun2.apply(<span class="string">&quot;小熊&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="数组引用"><a href="#数组引用" class="headerlink" title="数组引用"></a>数组引用</h3><p><strong>格式：</strong> <strong>数组类型::new</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//数组引用</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method5</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//函数型接口，传入数组长度，返回对应数组类型及长度的数组</span></span><br><span class="line">    Function&lt;Integer,String[]&gt; fun1 = (x) -&gt; <span class="keyword">new</span> <span class="title class_">String</span>[x];</span><br><span class="line">    String[] str1 = fun1.apply(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">    Function&lt;Integer,String[]&gt; fun2 = String[]::<span class="keyword">new</span>;</span><br><span class="line">    String[] str2 = fun2.apply(<span class="number">20</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/lambda/" rel="tag">lambda</a></li></ul>

    </footer>
  </div>

    
 
   
  
</article>

    
    <article
  id="post-选择排序的双指针优化"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/11/02/%E9%80%89%E6%8B%A9%E6%8E%92%E5%BA%8F%E7%9A%84%E5%8F%8C%E6%8C%87%E9%92%88%E4%BC%98%E5%8C%96/"
    >选择排序的双指针优化</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2020/11/02/%E9%80%89%E6%8B%A9%E6%8E%92%E5%BA%8F%E7%9A%84%E5%8F%8C%E6%8C%87%E9%92%88%E4%BC%98%E5%8C%96/" class="article-date">
  <time datetime="2020-11-02T09:36:21.000Z" itemprop="datePublished">2020-11-02</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E7%AE%97%E6%B3%95/">算法</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h2 id="先整清楚选择排序"><a href="#先整清楚选择排序" class="headerlink" title="先整清楚选择排序"></a>先整清楚<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E9%80%89%E6%8B%A9%E6%8E%92%E5%BA%8F&spm=1001.2101.3001.7020">选择排序</a></h2><h3 id="什么是选择排序？"><a href="#什么是选择排序？" class="headerlink" title="什么是选择排序？"></a>什么是选择排序？</h3><p><code>矮子里面挑将军</code>——双重循环<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E9%81%8D%E5%8E%86&spm=1001.2101.3001.7020">遍历</a>数组，每经过一轮比较，找到最小元素的下标，将其交换至首位，下次排序时它就不参与排序了，而是从<strong>剩余</strong>的数据中挑选最值。</p>
<p><img src="http://qn.mfei.fun/img/image-20220920143957257.png" alt="image-20220920143957257"></p>
<h3 id="手写一个选择排序"><a href="#手写一个选择排序" class="headerlink" title="手写一个选择排序"></a>手写一个选择排序</h3><p>目标数组：{1, 0, 3, 8, 7, 2, 0, 5, 4, 6}</p>
<p>目标结果：顺序升序排序</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">selectionSort</span><span class="params">()</span> &#123;</span><br><span class="line">	<span class="type">int</span>[] arr = &#123;<span class="number">1</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">6</span>&#125;;</span><br><span class="line">    <span class="type">int</span> minIndex;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; arr.length - <span class="number">1</span>; i++) &#123;</span><br><span class="line">        minIndex = i;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> i + <span class="number">1</span>; j &lt; arr.length; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (arr[minIndex] &gt; arr[j]) &#123;</span><br><span class="line">                <span class="comment">// 记录最小值的下标</span></span><br><span class="line">                minIndex = j;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 将最小元素交换至首位</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> arr[i];</span><br><span class="line">        arr[i] = arr[minIndex];</span><br><span class="line">        arr[minIndex] = temp;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 输出一下</span></span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i : arr) &#123;</span><br><span class="line">		System.err.print(i);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="选择排序和冒泡排序有什么区别？"><a href="#选择排序和冒泡排序有什么区别？" class="headerlink" title="选择排序和冒泡排序有什么区别？"></a>选择排序和<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E5%86%92%E6%B3%A1%E6%8E%92%E5%BA%8F&spm=1001.2101.3001.7020">冒泡排序</a>有什么区别？</h3><p><code>回想下两种排序的原理图，还是有不一样的地方的</code></p>
<p>冒泡排序和选择排序虽然都是双for循环排序，时间复杂度也都是O(n^2)…巴拉巴拉…。但是！<strong>冒泡排序每轮选取最值时，这个比较的过程是在不断地交换的；选</strong></p>
<p><strong>择排序每轮选取最值是通过一个变量记录最值索引，该轮比较结束后进行一次交换</strong>。可见选择排序很大程度上减少了交换次数。</p>
<p><code>你以为这就完了</code>？这两种排序方式还有个极大的差别就是——<strong>冒泡排序是稳定的，选择排序是不稳定（排序前后相同值元素的前后位置可能会发生变化）的</strong>。</p>
<hr>

<h2 id="算法优化"><a href="#算法优化" class="headerlink" title="算法优化"></a>算法优化</h2><h3 id="最大值和最小值每轮比较只能得其一吗？"><a href="#最大值和最小值每轮比较只能得其一吗？" class="headerlink" title="最大值和最小值每轮比较只能得其一吗？"></a>最大值和最小值每轮比较只能得其一吗？</h3><p><code>我们可以控制选择排序每轮比较选择出最大值还是者最小值，那么，我全都要呢？</code><br>本着这个目标，就上面的代码，稍作优化：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">selectionSort</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">int</span>[] arr = &#123;<span class="number">1</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">6</span>&#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; arr.length/<span class="number">2</span>; i++) &#123;</span><br><span class="line">        System.out.print(<span class="string">&quot;第&quot;</span>+(i+<span class="number">1</span>)+<span class="string">&quot;次选最值——&quot;</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">minIndex</span> <span class="operator">=</span> i;</span><br><span class="line">        <span class="type">int</span> <span class="variable">maxIndex</span> <span class="operator">=</span> arr.length - <span class="number">1</span> - i;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> i + <span class="number">1</span>; j &lt;= arr.length - <span class="number">1</span> - i; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (arr[minIndex] &gt; arr[j]) &#123;</span><br><span class="line">                <span class="comment">// 记录最小值的下标</span></span><br><span class="line">                minIndex = j;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (arr[maxIndex] &lt; arr[j]) &#123;</span><br><span class="line">                <span class="comment">// 记录最大值的下标</span></span><br><span class="line">                maxIndex = j;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 将最小元素交换至首位</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> arr[i];</span><br><span class="line">        arr[i] = arr[minIndex];</span><br><span class="line">        arr[minIndex] = temp;</span><br><span class="line">        System.out.print(<span class="string">&quot;最小值为：&quot;</span>+arr[i]);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 这步很关键！</span></span><br><span class="line">        <span class="keyword">if</span> (maxIndex == i)&#123;</span><br><span class="line">            maxIndex = minIndex;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将最大元素交换至末位</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">tem</span> <span class="operator">=</span> arr[arr.length - i - <span class="number">1</span>];</span><br><span class="line">        arr[arr.length - i - <span class="number">1</span>] = arr[maxIndex];</span><br><span class="line">        arr[maxIndex] = tem;</span><br><span class="line">        System.out.println(<span class="string">&quot;最大值为：&quot;</span>+arr[arr.length - i - <span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 输出一下</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i : arr) &#123;</span><br><span class="line">        System.err.print(i);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>总结的话就不说了，<strong>外层循环次数少了一半，内层循环次数也少了一半</strong>，你懂的。</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%AE%97%E6%B3%95/" rel="tag">算法</a></li></ul>

    </footer>
  </div>

    
 
   
  
</article>

    
    <article
  id="post-Docker运行Nginx容器"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/10/27/Docker%E8%BF%90%E8%A1%8CNginx%E5%AE%B9%E5%99%A8/"
    >Docker运行Nginx容器</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2020/10/27/Docker%E8%BF%90%E8%A1%8CNginx%E5%AE%B9%E5%99%A8/" class="article-date">
  <time datetime="2020-10-27T10:15:39.000Z" itemprop="datePublished">2020-10-27</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E8%BF%90%E7%BB%B4/">运维</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p><strong>整体步骤：</strong></p>
<ol>
<li>创建并运行容器，且在nginx容器创建时向宿主机挂载出一个空文件夹。</li>
<li>进入容器将conf.d移动到向宿主机挂载的空文件夹中。</li>
<li>进入向宿主机挂载的空文件夹中，并将conf.d软连接到其原本所在的目录。</li>
</ol>
<h2 id="拉取nginx镜像"><a href="#拉取nginx镜像" class="headerlink" title="拉取nginx镜像"></a>拉取nginx镜像</h2><ul>
<li>先<code>推荐个网站</code>，从你开始使用docker就要必备的——<a target="_blank" rel="noopener" href="https://hub.docker.com/">DockerHub</a>。一句话说明就是一个镜像大全。</li>
<li><code>寻找镜像资源</code>的话就在上面那个网站上搜索就行，版本、下载方式自选。</li>
<li><code>拉取镜像</code>的话在上面那个网站搜索后，拉取命令<code>docker pull nginx</code>直接给你了，且nginx无须在意版本，直接拉last版本即可。<img src="http://qn.mfei.fun/img/image-20220919151601854.png" alt="image-20220919151601854"></li>
</ul>
<h2 id="创建配置路径"><a href="#创建配置路径" class="headerlink" title="创建配置路径"></a>创建配置路径</h2><p>如果你选择容器管理nginx服务的话，请先不要着急启动，先<code>在宿主机新建一个文件夹</code>，这将是你之后<code>存放nginx配置</code>的地方。</p>
<h2 id="创建并启动容器"><a href="#创建并启动容器" class="headerlink" title="创建并启动容器"></a>创建并启动容器</h2><ul>
<li><p>控制台执行<code>docker images</code>检查镜像是否存在。</p>
</li>
<li><p>配置启动命令（创建容器很简单，但是想要好用，需要认真配置）</p>
<blockquote>
<p>最终命令：<code>docker run --name nginx-first -p 90:80 -v /var/dps/nginx:/nginx -d nginx</code></p>
<blockquote>
<p>解释：</p>
<p><code>docker run nginx</code>，为生成nginx镜像的容器。<br><code>--name nginx-first</code>，指定容器名称为nginx-first。<br><code>-p 90:80</code>，指将容器中80端口映射到宿主机90端口。</p>
<p><code>-v /var/dps/nginx:/nginx</code>，指将容器中nginx某一文件夹<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E6%8C%82%E8%BD%BD&spm=1001.2101.3001.7020">挂载</a>到宿主机某一文件夹（左边为宿主机文件夹地址）。</p>
<p><code>-d</code>，表示后台运行该容器。</p>
</blockquote>
</blockquote>
</li>
</ul>
<h2 id="设置nginx配置"><a href="#设置nginx配置" class="headerlink" title="设置nginx配置"></a>设置nginx配置</h2><ul>
<li><p>将容器中nginx默认<code>conf.d配置文件夹移动到</code>启动容器命令中预设的<code>挂载目录</code>中。</p>
<blockquote>
<ol>
<li>查看容器<code>docker ps</code>，进入容器<code>docker exec -it [容器id] /bin/bash</code>。</li>
<li>cd到&#x2F;etc&#x2F;nginx目录中<code>cd /etc/nginx</code>。</li>
<li>再将该文件夹下conf.d文件夹移动到你预设的挂载目录中<code>rm /etc/nginx/conf.d /nginx</code>。</li>
</ol>
</blockquote>
</li>
<li><p>来到启动容器命令中预设的挂载目录中，<code>检查是否存在conf.d文件夹</code>。</p>
</li>
<li><p>在预设的挂载目录中，将conf.d文件夹软连接到其原本的位置<code>ln -s /nginx/conf.d /etc/nginx</code>。</p>
</li>
<li><p>此时即可在<code>宿主机的挂载目录中操作</code>nginx容器的default.conf文件或者<code>新增配置文件</code>了。</p>
</li>
</ul>
<h3 id="nginx配置文件在哪里？"><a href="#nginx配置文件在哪里？" class="headerlink" title="nginx配置文件在哪里？"></a>nginx配置文件在哪里？</h3><ul>
<li>nginx的配置文件默认是在<code>etc/nginx</code>文件夹下，该文件夹下有<code>nginx.conf</code>、<code>conf.d</code>两个配置文件夹，一般我们自定义的配置是要放在<code>conf.d</code>中的，故只需将<code>cong.d</code>挂载到宿主机即可。</li>
<li>如果你非想在自己去找找看，直接执行<code>docker run -d nginx</code></li>
</ul>
<h3 id="为什么不直接将nginx配置文件挂载出来？"><a href="#为什么不直接将nginx配置文件挂载出来？" class="headerlink" title="为什么不直接将nginx配置文件挂载出来？"></a>为什么不直接将nginx配置文件挂载出来？</h3><p>我们既然知道了容器中nginx的conf.d文件夹位置，为什么<code>不直接将其挂载出来</code>，反而要多此一举搞个<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E8%BD%AF%E8%BF%9E%E6%8E%A5&spm=1001.2101.3001.7020">软连接</a>？其实也不是不行，只是如果我们一上来就拿个空文件夹来挂载conf.d文件夹，会造成<code>覆盖</code>，使容器中conf.d文件夹也变成空文件夹，<code>间接删除了原有的default.conf文件</code>，我们还要从其他地方拷一个default.conf过来。</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/docker/" rel="tag">docker</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nginx/" rel="tag">nginx</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%9C%8D%E5%8A%A1%E5%99%A8/" rel="tag">服务器</a></li></ul>

    </footer>
  </div>

    
 
   
  
</article>

    
    <article
  id="post-枚举类使用场景"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/10/20/%E6%9E%9A%E4%B8%BE%E7%B1%BB%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF/"
    >枚举类使用场景</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2020/10/20/%E6%9E%9A%E4%B8%BE%E7%B1%BB%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF/" class="article-date">
  <time datetime="2020-10-20T12:12:05.000Z" itemprop="datePublished">2020-10-20</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/java/">java</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h2 id="枚举（enum）"><a href="#枚举（enum）" class="headerlink" title="枚举（enum）"></a><a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E6%9E%9A%E4%B8%BE&spm=1001.2101.3001.7020">枚举</a>（enum）</h2><p><strong>前言：</strong><br>初次学习，本人更注重<code>实用性</code>。许多文章都对枚举类进行了很详细的介绍，比如它是jdk1.5后引入的新特性、继承了 java.lang.<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=Enum&spm=1001.2101.3001.7020">Enum</a>类等，在此就不多阐述。本文重点解释<code>枚举类的字段</code>，以及一些<code>枚举类的使用场景</code>。</p>
<p><strong>枚举类的理解：</strong></p>
<ol>
<li>所谓枚举类，即类的对象只有有限个，确定的。我们称此类为枚举类。</li>
<li>当需要定义一组常量时，强烈建议使用枚举类。</li>
<li>如果枚举类中只有一个对象，则可以作为单列模式的实现方式。</li>
</ol>
<p>看完后是不是很懵逼？不慌，这些是别人文章中千篇一律的东西，本文中这些东西不会是重点。</p>
<hr>

<p><strong>如何写一个枚举类？</strong></p>
<p>jdk5.0之前，我们要自定义枚举类，jdk5.0，可以使用<code>enum</code>关键字定义枚举类。还是那句话，初次学习，我更注重应用。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">ColorEnum</span>&#123;</span><br><span class="line">	<span class="comment">//一个枚举类</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>我们常见的枚举类里的那些看不懂的东西：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EnumTest3</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(Colors.RED);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Colors</span>&#123;</span><br><span class="line">    RED,</span><br><span class="line">    GREEN,</span><br><span class="line">    PINK,</span><br><span class="line">    ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//执行结果为：</span></span><br><span class="line"><span class="comment">//RED</span></span><br></pre></td></tr></table></figure>

<p>先说说这几个<code>字段</code>（RED、GREEN、PINK）是啥。你以为它们是常量？好吧，开始我也这么以为，比如“Colors.RED”，是不是很像是通过类名访问静态变量？可它的输出结果又，，，，，最终我发现用<code>枚举类对象</code>形容它们更合适。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EnumTest3</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(Colors.GREEN.tes());<span class="comment">//此处GREEN相当于一个枚举类对象</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Colors</span>&#123;</span><br><span class="line">    RED&#123;</span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">tes</span><span class="params">()</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;这是RED对抽象方法的实现&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    GREEN&#123;</span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">tes</span><span class="params">()</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;这是GREEN对抽象方法的实现&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    PINK&#123;</span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">tes</span><span class="params">()</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;这是PINK对抽象方法的实现&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    ;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> String <span class="title function_">tes</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>从以上代码中的三个颜色的字段我们可以理解 <strong>“所谓枚举类，即类的对象只有有限个，确定的。我们称此类为枚举类。”</strong> 这句话了。<br>那么问题又来了，<code>这些字段如何去用呢</code>？</p>
<ol>
<li><p>字段配合抽象方法使用(<code>抽象方法一经定义，所有字段必须实现</code>)。同时字段中也可以（只能）重写枚举类中的普通方法（<code>字段中不能写枚举类中不存在的新的方法</code>）。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EnumTest3</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(Colors.GREEN.tes2());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Colors</span>&#123;</span><br><span class="line">	GREEN&#123;</span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">tes</span><span class="params">()</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;这是GREEN对抽象方法的实现&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">tes2</span><span class="params">()</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;这是对抽象类中方法的重写&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    PINK&#123;</span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">tes</span><span class="params">()</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;这是PINK对抽象方法的实现&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    ;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> String <span class="title function_">tes</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">tes2</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;这是enum自己的方法&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>字段配合构造器使用。可用于前后端分离时，为前端<code>返回状态码</code>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EnumTest3</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(Colors.RED.getColor());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Colors</span> &#123;</span><br><span class="line">    RED(<span class="string">&quot;red&quot;</span>,<span class="string">&quot;这是红色&quot;</span>) &#123;&#125;,</span><br><span class="line">    PINK(<span class="string">&quot;pink&quot;</span>,<span class="string">&quot;这是粉色&quot;</span>) &#123;&#125;,</span><br><span class="line">    ;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String color;</span><br><span class="line">    <span class="keyword">private</span> String describe;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Colors</span><span class="params">(String color, String describe)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.color = color;</span><br><span class="line">        <span class="built_in">this</span>.describe = describe;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getColor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> color;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setColor</span><span class="params">(String color)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.color = color;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getDescribe</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> describe;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setDescribe</span><span class="params">(String describe)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.describe = describe;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="枚举的内存占用问题"><a href="#枚举的内存占用问题" class="headerlink" title="枚举的内存占用问题"></a>枚举的内存占用问题</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/vfush/article/details/79881818?ops_request_misc=&request_id=&biz_id=102&utm_term=%E6%9E%9A%E4%B8%BE%E4%B8%BA%E4%BB%80%E4%B9%88%E5%8D%A0%E5%86%85%E5%AD%98&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-0-79881818.nonecase">参考文章</a>,个人感觉这一篇就已经写的很详细了，在此推荐一下。<br>关于内存问题总结如下：</p>
<ol>
<li>可通过一些反编译手段，比如黑窗口中javap -p ***.class 命令，或者jad工具，推荐后者。</li>
<li>枚举类是一个继承java.lang.Enum的final类，它的成员变量也是final常量。</li>
<li>我们定义的枚举，编译器会将其转换成一个类（这就是说为什么枚举本身就是一个类），编译器还会帮我们生成多个枚举类的实例，赋值给我们定义的枚举类型常量，并且还声明了一个枚举对象的数组，保存了所有的枚举对象。<a target="_blank" rel="noopener" href="https://blog.csdn.net/xiao_nian/article/details/80002101?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522160834401016780304676548%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=160834401016780304676548&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-1-80002101.nonecase&utm_term=%E6%9E%9A%E4%B8%BE%E4%B8%BA%E4%BB%80%E4%B9%88%E5%8D%A0%E5%86%85%E5%AD%98">参考博客</a></li>
</ol>
<p><strong>对于枚举的常用方法啥的，在此就不一一解释了，相信大多数博客中都有介绍。</strong></p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Enum/" rel="tag">Enum</a></li></ul>

    </footer>
  </div>

    
 
   
  
</article>

    
    <article
  id="post-冒泡排序的异或优化"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/10/14/%E5%86%92%E6%B3%A1%E6%8E%92%E5%BA%8F%E7%9A%84%E5%BC%82%E6%88%96%E4%BC%98%E5%8C%96/"
    >冒泡排序的异或优化</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2020/10/14/%E5%86%92%E6%B3%A1%E6%8E%92%E5%BA%8F%E7%9A%84%E5%BC%82%E6%88%96%E4%BC%98%E5%8C%96/" class="article-date">
  <time datetime="2020-10-14T06:16:02.000Z" itemprop="datePublished">2020-10-14</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E7%AE%97%E6%B3%95/">算法</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h2 id="你会写冒泡排序吗"><a href="#你会写冒泡排序吗" class="headerlink" title="你会写冒泡排序吗"></a>你会写<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E5%86%92%E6%B3%A1%E6%8E%92%E5%BA%8F&spm=1001.2101.3001.7020">冒泡排序</a>吗</h2><p>给你一个数组，让你排序，怎么办？（别跟我扯sort函数）<br>方法很多，但是看标题，今天就用冒泡！</p>
<p><img src="http://qn.mfei.fun/img/image-20220920141924627.png" alt="image-20220920141924627"></p>
<p>你可能会这样写？</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span>[] poLuPoLuSort(<span class="type">int</span>[] arr)&#123;</span><br><span class="line">	<span class="type">int</span> temp;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; arr.length; i++)&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; arr.length; j++)&#123;</span><br><span class="line">            <span class="keyword">if</span> (arr[i] &gt; arr[j])&#123;</span><br><span class="line">                temp = arr[i];</span><br><span class="line">                arr[i] = arr[j];</span><br><span class="line">                arr[j] = temp;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>也或许你会这样写</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span>[] poLuPoLuSort(<span class="type">int</span>[] arr)&#123;</span><br><span class="line">	<span class="type">int</span> temp;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; arr.length; i++)&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> i+<span class="number">1</span>; j &lt; arr.length; j++)&#123;</span><br><span class="line">            <span class="keyword">if</span> (arr[i] &gt; arr[j])&#123;</span><br><span class="line">                temp = arr[i];</span><br><span class="line">                arr[i] = arr[j];</span><br><span class="line">                arr[j] = temp;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="有没有想过不要temp？"><a href="#有没有想过不要temp？" class="headerlink" title="有没有想过不要temp？"></a>有没有想过不要temp？</h2><p>temp作为冒泡排序中的经典变量，你可曾想过哪一天能够把它去除？把值交换做到想象中的一样简单，交换就是交换，为嘛我的先给路人甲，你的再给我，你再去向路人甲要，没路人甲就不办事了吗？</p>
<p>你不妨试一下这种写法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span>[] poLuPoLuSort(<span class="type">int</span>[] arr)&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; arr.length; i++)&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> i+<span class="number">1</span>; j &lt; arr.length; j++)&#123;</span><br><span class="line">            <span class="keyword">if</span> (arr[i] &gt; arr[j])&#123;</span><br><span class="line">                arr[j] ^= arr[i];</span><br><span class="line">                arr[i] ^= arr[j];</span><br><span class="line">                arr[j] ^= arr[i];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>你看到了，这次没有temp了。</p>
<h2 id="用异或运算交换变量值"><a href="#用异或运算交换变量值" class="headerlink" title="用异或运算交换变量值"></a>用<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E5%BC%82%E6%88%96%E8%BF%90%E7%AE%97&spm=1001.2101.3001.7020">异或运算</a>交换变量值</h2><p>你我都懂，异或运算是用在二进制之间的一种运算，同则0异则1…巴拉巴拉…。<code>1^1=0</code>、<code>1^0=1</code>、<code>0^0=0</code></p>
<p>那我就是要用 5^6 会怎么样呢？<code>5^6=?</code></p>
<p>那必是一个和5、6都无关的值啊，你在想什么？</p>
<p><strong>但是课本上有这样三个公式：<code>a^a=0</code>、<code>a^a^b=b</code>、<code>0^b=b</code></strong></p>
<p>第一个我知道你懂，我第一次看也懂了，那么第二个…</p>
<p>假设<code>b=3</code>，因为<code>a^a=0</code>，所以<code>a^a^b=0^b=0^3</code>，<code>0^3</code>…</p>
<p>3的二进制是11,<code>00^11=11</code> → 还是3！</p>
<p>整数转二进制不过是01组合，<code>0^0=0</code>，<code>1^0=1</code>，那不就是<code>0^b=b</code></p>
<p><strong>还不懂？</strong></p>
<p>再看看这组代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">arr[j] ^= arr[i];</span><br><span class="line">arr[i] ^= arr[j];</span><br><span class="line">arr[j] ^= arr[i];</span><br></pre></td></tr></table></figure>

<p>设 <code>arr[i]=X</code>、<code>arr[j]=Y</code></p>
<p>①<code>arr[j] ^= arr[i];</code> → <code>arr[j]=Y^X</code></p>
<p>②<code>arr[i] ^= arr[j];</code> → <code>arr[i]=X^Y^X=Y</code> → <code>arr[i]=Y</code></p>
<p>③<code>arr[j] ^= arr[i];</code> → <code>arr[j]=Y^X^Y=X</code> → <code>arr[j]=X</code></p>
<h2 id="引申问题"><a href="#引申问题" class="headerlink" title="引申问题"></a>引申问题</h2><p><strong>给你一个数组，里面有若干数据，其中只有一个数据元素出现的次数是奇数次，请你找出这个出现次数为奇数次的元素。</strong></p>
<p>对！文章看到这里了，你还遍历元素，给每个元素都加一个计数器，用<code>==</code>对比判断。</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%AE%97%E6%B3%95/" rel="tag">算法</a></li></ul>

    </footer>
  </div>

    
 
   
  
</article>

    
    <article
  id="post-JavaWeb——Servlet"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/10/09/JavaWeb%E2%80%94%E2%80%94Servlet/"
    >JavaWeb——Servlet</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2020/10/09/JavaWeb%E2%80%94%E2%80%94Servlet/" class="article-date">
  <time datetime="2020-10-09T13:28:17.000Z" itemprop="datePublished">2020-10-09</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/web%E5%BC%80%E5%8F%91/">web开发</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h2 id="Servlet简介"><a href="#Servlet简介" class="headerlink" title="Servlet简介"></a>Servlet简介</h2><p><span style="color:red">Servlet通常指的就是实现Servlet接口的java类，通过对http请求进行处理并响应结果，用以开发动态web。</span></p>
<ul>
<li><code>Servlet</code>是sun公司<code>开发动态web的一门技术</code>。</li>
<li>通常把<code>实现了Servlet接口</code>的Java程序叫做Servlet。</li>
<li>Servlet在sun公司有两个默认实现类<code>HttpServlet</code>和<code>GenericServlet</code></li>
<li>HttpServlet类继承GenericServlet类，GenericServlet类继承Servlet接口，故我们的类只需要继承<code>HttpServlet</code>类即可。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">// ServletOutputStream outputStream = resp.getOutputStream();</span></span><br><span class="line">        <span class="type">PrintWriter</span> <span class="variable">writer</span> <span class="operator">=</span> resp.getWriter(); <span class="comment">// 响应流</span></span><br><span class="line">        writer.println(<span class="string">&quot;Hello,Servlet&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        doGet(req, resp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Servlet工作原理"><a href="#Servlet工作原理" class="headerlink" title="Servlet工作原理"></a>Servlet工作原理</h2><p><img src="http://qn.mfei.fun/img/I2@9KQ%7B9UPO[@%Q%FR1%7D~AQ.png" alt="img"></p>
<p>用户在上网时，由客户端浏览器<code>发送http请求</code>至服务器，服务器根据用户请求方式及地址从磁盘中<code>加载对应的Servlet程序文件</code>到Servlet容器。服务器<code>解析http请求为request对象</code>，<code>转发request对象到相应Servlet中</code>进行处理，Servlet<code>处理后返回response对象</code>，服务器再<code>将response对象转为http响应</code>，响应给客户端浏览器。</p>
<h2 id="编写Servlet映射"><a href="#编写Servlet映射" class="headerlink" title="编写Servlet映射"></a>编写Servlet映射</h2><p><span style="color:red">要通过浏览器访问java程序，而浏览器需要连接web服务器，所以需要在web服务中注册Servlet，还要给它一个浏览器能够访问的路径。</span></p>
<h4 id="注册方式一"><a href="#注册方式一" class="headerlink" title="注册方式一"></a>注册方式一</h4><p><code>@WebServlet注解</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// test只是个名字而已，value为访问地址</span></span><br><span class="line"><span class="meta">@WebServlet(name = &quot;test&quot;, value = &quot;/hello&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">// ServletOutputStream outputStream = resp.getOutputStream();</span></span><br><span class="line">        <span class="type">PrintWriter</span> <span class="variable">writer</span> <span class="operator">=</span> resp.getWriter(); <span class="comment">// 响应流</span></span><br><span class="line">        writer.println(<span class="string">&quot;Hello,Servlet&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        doGet(req, resp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="注册方式二"><a href="#注册方式二" class="headerlink" title="注册方式二"></a>注册方式二</h4><p><code>web.xml</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;web-app&gt;</span><br><span class="line">  &lt;!--web.xml中是配置web的核心应用--&gt;</span><br><span class="line">  &lt;!--注册Servlet--&gt;</span><br><span class="line">  &lt;servlet&gt;</span><br><span class="line">    &lt;!--Servlet名字--&gt;</span><br><span class="line">    &lt;servlet-name&gt;SpenceServlet&lt;/servlet-name&gt;</span><br><span class="line">    &lt;!--Servlet指向的类--&gt;</span><br><span class="line">    &lt;servlet-class&gt;com.spence.HelloServlet&lt;/servlet-class&gt;</span><br><span class="line">  &lt;/servlet&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;!--一个Servlet对应一个Mapping：映射--&gt;</span><br><span class="line">  &lt;servlet-mapping&gt;</span><br><span class="line">    &lt;!--通过名字绑定一个Servlet--&gt;</span><br><span class="line">    &lt;servlet-name&gt;SpenceServlet&lt;/servlet-name&gt;</span><br><span class="line">    &lt;!--该Servlet的请求地址--&gt;</span><br><span class="line">    &lt;url-pattern&gt;/spence&lt;/url-pattern&gt;</span><br><span class="line">  &lt;/servlet-mapping&gt;</span><br><span class="line"></span><br><span class="line">&lt;/web-app&gt;</span><br></pre></td></tr></table></figure>

<p>注意：<code>&lt;servlet-mapping&gt;</code>标签与<code>&lt;servlet&gt;</code>标签一一对应，且<code>&lt;servlet&gt;标签要在&lt;servlet-mapping&gt;标签上面</code>。</p>
<h2 id="Servlet核心对象"><a href="#Servlet核心对象" class="headerlink" title="Servlet核心对象"></a>Servlet核心对象</h2><h3 id="ServletContext"><a href="#ServletContext" class="headerlink" title="ServletContext"></a>ServletContext</h3><p><span style="color:red">ServletContext是上下文对象，用于管理整个web应用</span></p>
<p>web容器在启动时，会为每个web程序（每个Service）都创建一个对应的ServletContext对象，<code>它代表当前web应用</code>。但要注意，<code>每个web程序（Servlet类）中创建的ServletContext对象其实是同一个对象</code>，因此可通过ServletContext对象使得各个Servlet类中的数据互通共享（ServletContext对象凌驾于所有Servlet类之上，它是<code>由web容器（服务器）创建的</code>）。</p>
<h4 id="应用场景——资源共享"><a href="#应用场景——资源共享" class="headerlink" title="应用场景——资源共享"></a>应用场景——资源共享</h4><p><code>向ServletContext对象中存入数据</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SetServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="type">ServletContext</span> <span class="variable">servletContext</span> <span class="operator">=</span> <span class="built_in">this</span>.getServletContext();</span><br><span class="line">        <span class="type">String</span> <span class="variable">userName</span> <span class="operator">=</span> <span class="string">&quot;哥哥&quot;</span>;</span><br><span class="line">        <span class="comment">// 将一个数据以键值对形式保存在了 servletContext 中</span></span><br><span class="line">        servletContext.setAttribute(<span class="string">&quot;userName&quot;</span>, userName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        doGet(req, resp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>从ServletContext对象中取出对象</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GetServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="type">ServletContext</span> <span class="variable">servletContext</span> <span class="operator">=</span> <span class="built_in">this</span>.getServletContext();</span><br><span class="line">        <span class="type">String</span> <span class="variable">userName</span> <span class="operator">=</span> (String) servletContext.getAttribute(<span class="string">&quot;userName&quot;</span>);</span><br><span class="line">        resp.setContentType(<span class="string">&quot;text/html&quot;</span>);</span><br><span class="line">        resp.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">        <span class="type">PrintWriter</span> <span class="variable">writer</span> <span class="operator">=</span> resp.getWriter();</span><br><span class="line">        writer.println(userName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        doGet(req, resp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="应用场景——获取初始化参数"><a href="#应用场景——获取初始化参数" class="headerlink" title="应用场景——获取初始化参数"></a>应用场景——获取初始化参数</h4><p><code>可在web.xml配置文件中写入一些初始化参数</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">web-app</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line">  <span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>jdbc_url<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>jdbc:mysql://localhost:3306/mybatis<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>通过ServletContext对象中getInitParameter方法读取初始化参数</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">    <span class="type">ServletContext</span> <span class="variable">servletContext</span> <span class="operator">=</span> <span class="built_in">this</span>.getServletContext();</span><br><span class="line">    <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> servletContext.getInitParameter(<span class="string">&quot;jdbc_url&quot;</span>); <span class="comment">// 读入初始化参数</span></span><br><span class="line">    <span class="type">PrintWriter</span> <span class="variable">writer</span> <span class="operator">=</span> resp.getWriter();</span><br><span class="line">    writer.println(url);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="应用场景——请求转发"><a href="#应用场景——请求转发" class="headerlink" title="应用场景——请求转发"></a>应用场景——请求转发</h4><p><span style="color:red">通过ServletContext对象中getRequestDispatcher方法写入转发请求路径，再通过RequestDispatcher对象的forward方法实现转发。相当于指明一个新的请求路径，把请求和响应参数传入到新的请求中（该种情况不同于重定向，不会改变浏览器页中URL地址）。</span></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">    <span class="type">ServletContext</span> <span class="variable">servletContext</span> <span class="operator">=</span> <span class="built_in">this</span>.getServletContext();</span><br><span class="line">    <span class="type">RequestDispatcher</span> <span class="variable">requestDispatcher</span> <span class="operator">=</span> servletContext.getRequestDispatcher(<span class="string">&quot;/jdbc&quot;</span>); <span class="comment">// 转发的请求路径</span></span><br><span class="line">    requestDispatcher.forward(req, resp); <span class="comment">// 调用forward实现转发</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="应用场景——读取资源文件"><a href="#应用场景——读取资源文件" class="headerlink" title="应用场景——读取资源文件"></a>应用场景——读取资源文件</h4><p>想办法搞出一个文件流即可。</p>
<ul>
<li>在java目录下新建properties文件</li>
<li>在resources目录下新建properties文件</li>
</ul>
<p>发现：都被打包到了同一个路径下—&gt; class，我们俗称这个路径为classpath。</p>
<p><code>在resources目录下新建 db.properties 文件</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">username=root</span><br><span class="line">password=<span class="number">123456</span></span><br></pre></td></tr></table></figure>

<p><code>通过ServletContext对象中 getResourceAsStream 方法读取文件</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">    <span class="type">ServletContext</span> <span class="variable">servletContext</span> <span class="operator">=</span> <span class="built_in">this</span>.getServletContext();</span><br><span class="line">    <span class="comment">// 通过 getResourceAsStream 方法读取文件  /WEB-INF/classes/db.properties 为打包后文件所在相对路径</span></span><br><span class="line">    <span class="type">InputStream</span> <span class="variable">iStream</span> <span class="operator">=</span> servletContext.getResourceAsStream(<span class="string">&quot;/WEB-INF/classes/db.properties&quot;</span>); <span class="comment">// File流为绝对路径，在线上不方便使用</span></span><br><span class="line">    <span class="type">Properties</span> <span class="variable">prop</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">    prop.load(iStream);</span><br><span class="line">    <span class="comment">// 获取配置文件中信息</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> prop.getProperty(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> prop.getProperty(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">    <span class="type">PrintWriter</span> <span class="variable">writer</span> <span class="operator">=</span> resp.getWriter();</span><br><span class="line">    writer.println(username +<span class="string">&quot;:&quot;</span>+ password);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="HttpServletResponse"><a href="#HttpServletResponse" class="headerlink" title="HttpServletResponse"></a>HttpServletResponse</h3><p>web服务器收到客户端http请求后，针对该请求分别创建一个代表请求的HttpServletRequest对象，和一个<code>代表响应的HttpServletResponse对象</code>。</p>
<ul>
<li>如果要获取客户端请求过来的数据：去HttpServletRequest对象中找</li>
<li>如果要给客户端响应过去一些数据：向HttpServletRequest对象添加</li>
</ul>
<p><code>负责向浏览器发送数据的方法：</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 平常的流</span></span><br><span class="line">ServletOutputStream <span class="title function_">getOutputStream</span><span class="params">()</span> <span class="keyword">throws</span> IOException;</span><br><span class="line"><span class="comment">// 字符</span></span><br><span class="line">PrintWriter <span class="title function_">getWriter</span><span class="params">()</span> <span class="keyword">throws</span> IOException;</span><br></pre></td></tr></table></figure>

<p><code>负责向浏览器发送一些响应头的方法</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置响应的编码</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">setCharacterEncoding</span><span class="params">(String var1)</span>;</span><br><span class="line"><span class="comment">// 设置响应字符串长度</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">setContentLength</span><span class="params">(<span class="type">int</span> var1)</span>;</span><br><span class="line"><span class="comment">// 设置流长度</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">setContentLengthLong</span><span class="params">(<span class="type">long</span> var1)</span>;</span><br><span class="line"><span class="comment">// 设置类型</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">setContentType</span><span class="params">(String var1)</span>;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h4 id="应用场景——-向浏览器输出消息"><a href="#应用场景——-向浏览器输出消息" class="headerlink" title="应用场景—— 向浏览器输出消息"></a>应用场景—— 向浏览器输出消息</h4><p>getOutputStream、getWriter等</p>
<h4 id="应用场景——验证码功能"><a href="#应用场景——验证码功能" class="headerlink" title="应用场景——验证码功能"></a>应用场景——验证码功能</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">    <span class="comment">// 让浏览器3秒自动刷新一次</span></span><br><span class="line">    resp.setHeader(<span class="string">&quot;refresh&quot;</span>, <span class="string">&quot;3&quot;</span>);</span><br><span class="line">    <span class="comment">// 在内存中创建一个图片</span></span><br><span class="line">    <span class="type">BufferedImage</span> <span class="variable">image</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedImage</span>(<span class="number">80</span>, <span class="number">20</span>, BufferedImage.TYPE_INT_BGR);</span><br><span class="line">    <span class="comment">// 得到图片</span></span><br><span class="line">    <span class="type">Graphics2D</span> <span class="variable">g</span> <span class="operator">=</span> (Graphics2D)image.getGraphics(); <span class="comment">// 画笔</span></span><br><span class="line">    <span class="comment">// 设置画笔颜色</span></span><br><span class="line">    g.setColor(Color.PINK);</span><br><span class="line">    <span class="comment">// 给图片填充数据</span></span><br><span class="line">    g.fillRect(<span class="number">0</span>, <span class="number">0</span>, <span class="number">80</span>, <span class="number">20</span>);</span><br><span class="line">    <span class="comment">// 给图片写入数据</span></span><br><span class="line">    g.setColor(Color.BLUE);</span><br><span class="line">    g.setFont(<span class="keyword">new</span> <span class="title class_">Font</span>(<span class="literal">null</span>, Font.BOLD, <span class="number">20</span>));</span><br><span class="line">    g.drawString(makeNum(), <span class="number">0</span>, <span class="number">20</span>);</span><br><span class="line">    <span class="comment">// 告诉浏览器，这个请求用图片的方式打开</span></span><br><span class="line">    resp.setContentType(<span class="string">&quot;image/jpeg&quot;</span>);</span><br><span class="line">    <span class="comment">// 不让浏览器缓存</span></span><br><span class="line">    resp.setDateHeader(<span class="string">&quot;expires&quot;</span>, -<span class="number">1</span>);</span><br><span class="line">    resp.setHeader(<span class="string">&quot;Cache-Control&quot;</span>, <span class="string">&quot;no-cache&quot;</span>);</span><br><span class="line">    resp.setHeader(<span class="string">&quot;Pragma&quot;</span>, <span class="string">&quot;no-cache&quot;</span>);</span><br><span class="line">    <span class="comment">// 把图片写给浏览器</span></span><br><span class="line">    ImageIO.write(image, <span class="string">&quot;jpg&quot;</span>, resp.getOutputStream());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 生成随机数</span></span><br><span class="line"><span class="keyword">private</span> String <span class="title function_">makeNum</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">Random</span> <span class="variable">random</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line">    <span class="type">String</span> <span class="variable">num</span> <span class="operator">=</span> random.nextInt(<span class="number">9999999</span>) + <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="type">StringBuffer</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuffer</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">7</span>-num.length(); i++) &#123;</span><br><span class="line">        sb.append(<span class="string">&quot;0&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> sb.toString()+num;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="应用场景——下载文件"><a href="#应用场景——下载文件" class="headerlink" title="应用场景——下载文件"></a>应用场景——下载文件</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> 获取要下载文件的路径</span><br><span class="line"><span class="number">2.</span> 下载的文件名</span><br><span class="line"><span class="number">3.</span> 让浏览器能够支持所需下载的东西</span><br><span class="line"><span class="number">4.</span> 创建下载文件的输入流</span><br><span class="line"><span class="number">5.</span> 创建缓冲区</span><br><span class="line"><span class="number">6.</span> 获取OutputStream对象</span><br><span class="line"><span class="number">7.</span> 将FileOutputStream流写入到buffer缓冲区，使用OutputStream将缓冲区中的数据输出到客户端</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">    <span class="comment">// 1. 获取要下载文件的路径</span></span><br><span class="line">    <span class="comment">// String realPath = this.getServletContext().getRealPath(&quot;/pic_01.png&quot;);</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">realPath</span> <span class="operator">=</span> <span class="string">&quot;D:\\IDEA_WorkSpace\\my-demo\\maven-03-web\\web-03-test\\src\\main\\resources\\static\\img\\pic_01.png&quot;</span>;</span><br><span class="line">    <span class="comment">// 2. 下载的文件名</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> realPath.substring(realPath.lastIndexOf(<span class="string">&quot;//&quot;</span>) + <span class="number">1</span>);</span><br><span class="line">    <span class="comment">// 3. 让浏览器能够支持所需下载的东西</span></span><br><span class="line">    <span class="comment">// resp.setHeader(&quot;content-disposition&quot;, &quot;attachment;fileName&quot;+fileName);</span></span><br><span class="line">    <span class="comment">// 中文文件名用 URLEncoder.encode 编码，否则有可能乱码</span></span><br><span class="line">    resp.setHeader(<span class="string">&quot;content-disposition&quot;</span>, <span class="string">&quot;attachment;filename=&quot;</span>+ URLEncoder.encode(fileName, <span class="string">&quot;utf-8&quot;</span>));</span><br><span class="line">    <span class="comment">// 4. 创建下载文件的输入流</span></span><br><span class="line">    <span class="type">FileInputStream</span> <span class="variable">fileInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(realPath);</span><br><span class="line">    <span class="comment">// 5. 创建缓冲区</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">byte</span>[] buffer = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">    <span class="comment">// 6. 获取OutputStream对象</span></span><br><span class="line">    <span class="type">ServletOutputStream</span> <span class="variable">outputStream</span> <span class="operator">=</span> resp.getOutputStream();</span><br><span class="line">    <span class="comment">// 7. 将FileOutputStream流写入到buffer缓冲区，使用OutputStream将缓冲区中的数据输出到客户端</span></span><br><span class="line">    <span class="keyword">while</span> ((len = fileInputStream.read(buffer))&gt;<span class="number">0</span>)&#123;</span><br><span class="line">        outputStream.write(buffer,<span class="number">0</span> , len);</span><br><span class="line">    &#125;</span><br><span class="line">    fileInputStream.close();</span><br><span class="line">    outputStream.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="应用场景——实现重定向"><a href="#应用场景——实现重定向" class="headerlink" title="应用场景——实现重定向"></a>应用场景——实现重定向</h4><p><span style="color:red">一个web资源收到客户端请求后，他会通知客户端去访问另外一个web资源，这个过程叫重定向（该过程不同于转发，客户端浏览器中URL会发生改变）。</span></p>
<p><code>常见场景</code>：用户登录<br><code>重定向方法</code>：void sendRedirect(String var1) throws IOException;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">    <span class="comment">// 重定向</span></span><br><span class="line">    resp.sendRedirect(<span class="string">&quot;/test3/image&quot;</span>);</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * resp.sendRedirect(&quot;/test3/image&quot;);</span></span><br><span class="line"><span class="comment">     * 等价于</span></span><br><span class="line"><span class="comment">     * resp.setHeader(&quot;Location&quot;, &quot;/test3/image&quot;);</span></span><br><span class="line"><span class="comment">     * resp.setStatus(302);</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="HttpServletRequest"><a href="#HttpServletRequest" class="headerlink" title="HttpServletRequest"></a>HttpServletRequest</h3><p>HttpServletRequest代表客户端请求，用户通过Http协议访问服务器，<code>Http请求中的所有信息会被封装到HttpServletRequest</code>，通过这个HttpServletRequest的方法，获得客户端的所有信息。</p>
<h4 id="应用场景——获取前端传递的参数、请求转发"><a href="#应用场景——获取前端传递的参数、请求转发" class="headerlink" title="应用场景——获取前端传递的参数、请求转发"></a>应用场景——获取前端传递的参数、<strong>请求转发</strong></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String <span class="title function_">getParameter</span><span class="params">(String var1)</span>;</span><br><span class="line">String[] getParameterValues(String var1);</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">    req.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">    resp.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> req.getParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> req.getParameter(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">    String[] hobbies = req.getParameterValues(<span class="string">&quot;hobbies&quot;</span>);</span><br><span class="line">	<span class="comment">// 这里的 / 代表当前的web应用</span></span><br><span class="line">    req.getRequestDispatcher(<span class="string">&quot;/success.jsp&quot;</span>).forward(req, resp);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaWeb/" rel="tag">JavaWeb</a></li></ul>

    </footer>
  </div>

    
 
   
  
</article>

    
  </article>
  

  
  <nav class="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">下一页</a>
  </nav>
  
</section>
</div>

      <footer class="footer">
  <div class="outer">
    <ul>
      <li>
        Copyrights &copy;
        2019-2022
        <i class="ri-heart-fill heart_icon"></i> SpenceDou
      </li>
    </ul>
    <ul>
      <li>
        
      </li>
    </ul>
    <ul>
      <li>
        
        
        <span>
  <span><i class="ri-user-3-fill"></i>访问人数:<span id="busuanzi_value_site_uv"></span></span>
  <span class="division">|</span>
  <span><i class="ri-eye-fill"></i>浏览次数:<span id="busuanzi_value_page_pv"></span></span>
</span>
        
      </li>
    </ul>
    <ul>
      
    </ul>
    <ul>
      
    </ul>
    <ul>
      <li>
        <!-- cnzz统计 -->
        
        <script type="text/javascript" src='https://s9.cnzz.com/z_stat.php?id=1278069914&amp;web_id=1278069914'></script>
        
      </li>
    </ul>
  </div>
</footer>    
    </main>
    <div class="float_btns">
      <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>

<div class="todark" id="todark">
  <i class="ri-moon-line"></i>
</div>

    </div>
    <aside class="sidebar on">
      <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/ayer-side.svg" alt="风大，进来说"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">归档</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">分类</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">标签</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/2019/about">关于我</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="搜索">
        <i class="ri-search-line"></i>
      </a>
      
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>请我喝杯咖啡吧~</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="/images/alipay.jpg">
      <span class="reward-type">支付宝</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="/images/wechat.jpg">
      <span class="reward-type">微信</span>
    </div>
    
  </div>
</div>
    
<script src="/js/jquery-3.6.0.min.js"></script>
 
<script src="/js/lazyload.min.js"></script>

<!-- Tocbot -->

<script src="https://cdn.staticfile.org/jquery-modal/0.9.2/jquery.modal.min.js"></script>
<link
  rel="stylesheet"
  href="https://cdn.staticfile.org/jquery-modal/0.9.2/jquery.modal.min.css"
/>
<script src="https://cdn.staticfile.org/justifiedGallery/3.8.1/js/jquery.justifiedGallery.min.js"></script>

<script src="/dist/main.js"></script>

<!-- ImageViewer -->
 <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.staticfile.org/photoswipe/4.1.3/default-skin/default-skin.min.css">
<script src="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe.min.js"></script>
<script src="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // slider展开状态
                // todo: 这样不好，后面改成状态
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // 获得原图尺寸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script> 
<!-- MathJax -->

<!-- Katex -->

<!-- busuanzi  -->
 
<script src="/js/busuanzi-2.3.pure.min.js"></script>
 
<!-- ClickLove -->

<!-- ClickBoom1 -->

<!-- ClickBoom2 -->
 
<script src="/js/clickBoom2.js"></script>
 
<!-- CodeCopy -->
 
<link rel="stylesheet" href="/css/clipboard.css">
 <script src="https://cdn.staticfile.org/clipboard.js/2.0.10/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="ri-file-copy-2-line"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-checkbox-circle-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-checkbox-circle-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-time-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-time-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);
</script>
 
<!-- CanvasBackground -->
 
<script src="/js/dz.js"></script>
 
<script>
  if (window.mermaid) {
    mermaid.initialize({ theme: "forest" });
  }
</script>


    
    

  </div>
</body>

</html>